å¥½çš„ï¼Œä¸‹é¢æ˜¯æ ¹æ®æ‚¨çš„è¦æ±‚è¿›ä¸€æ­¥å®Œå–„çš„ Quarto Reveal.js å¹»ç¯ç‰‡æ–‡æ¡£ï¼ˆ.qmd æ ¼å¼ï¼‰ï¼Œå…¶ä¸­åŒ…å«äº†æ›´è¯¦ç»†çš„å†…å®¹ã€ç¤ºä¾‹å’Œ emoji è¡¨æƒ…ï¼š

```qmd
---
title: "æ•°æ®åˆ†æç†è®ºä¸Pythonå®æˆ˜ ğŸ“Š"
subtitle: "ç¬¬äº”ç«  Pandasâ€”â€”å¤„ç†ç»“æ„åŒ–æ•°æ® ğŸ¼"
format:
  revealjs:
    theme: [sky]
    slide-number: true
    show-slide-number: all
    preview-links: auto
---

## ç›®å½•

- Pandasä»‹ç» ğŸ¼
- åŸºç¡€æ•°æ®ç»“æ„ ğŸ§±
- åŸºäºPandasçš„Indexå¯¹è±¡çš„è®¿é—®æ“ä½œ ğŸ”
- æ•°å­¦ç»Ÿè®¡å’Œè®¡ç®—å·¥å…· ğŸ§®
- æ•°å­¦èšåˆå’Œåˆ†ç»„è¿ç®— â•â–

## Pandasä»‹ç» ğŸ¼

::: {.callout-note}
Pandas æ˜¯ Python çš„ä¸€ä¸ª**å¼€æº**å·¥å…·åŒ…ï¼Œä¸º Python æä¾›äº†**é«˜æ€§èƒ½**ã€**ç®€å•æ˜“ç”¨**çš„æ•°æ®ç»“æ„å’Œæ•°æ®åˆ†æå·¥å…·ã€‚ å°±åƒä¸€ä¸ªè¶…çº§å·¥å…·ç®±ğŸ§°ï¼Œè®©æ•°æ®å¤„ç†å˜å¾—è½»æ¾åˆé«˜æ•ˆï¼
:::

- **ç±»è¡¨æ ¼ç»Ÿè®¡æ“ä½œ**ï¼šPandas æä¾›äº†æ–¹ä¾¿çš„ç±»ä¼¼äº Excel è¡¨æ ¼ ğŸ“Š çš„ç»Ÿè®¡æ“ä½œï¼Œå¯ä»¥è½»æ¾è¿›è¡Œæ±‚å’Œã€å¹³å‡ã€è®¡æ•°ç­‰ã€‚
- **ç±»SQLæ“ä½œ**ï¼šå¯ä»¥åƒæ“ä½œ SQL æ•°æ®åº“ ğŸ—„ï¸ ä¸€æ ·æ“ä½œæ•°æ®ï¼Œè¿›è¡Œæ•°æ®æŸ¥è¯¢ã€ç­›é€‰ã€è¿æ¥ç­‰ï¼Œéå¸¸é€‚åˆæ•°æ®é¢„å¤„ç†ã€‚
- **ç¼ºå¤±å€¼å¤„ç†**ï¼šPandas æä¾›äº†å¼ºå¤§çš„ç¼ºå¤±å€¼å¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥å¸®ä½ è½»æ¾æå®šæ•°æ®ä¸­çš„â€œæ´â€ğŸ•³ï¸ï¼Œä½¿æ•°æ®é¢„å¤„ç†æ›´ä¾¿æ·ã€‚

## Pandasä»‹ç» ğŸ¼

### Pandaså¯ä»¥å®Œæˆä»€ä¹ˆäº‹æƒ…ï¼Ÿ

- **ç´¢å¼•å¯¹è±¡**ï¼šåŒ…æ‹¬ç®€å•çš„ç´¢å¼•å’Œå¤šå±‚æ¬¡çš„ç´¢å¼•ï¼Œå°±åƒç»™æ•°æ®è´´ä¸Šæ ‡ç­¾ğŸ·ï¸ï¼Œæ–¹ä¾¿æŸ¥æ‰¾å’Œç®¡ç†ã€‚
- **å¼•æ“é›†æˆç»„åˆ**ï¼šç”¨äºæ±‡æ€»å’Œè½¬æ¢æ•°æ®é›†åˆï¼Œå¯ä»¥å°†å¤šä¸ªæ•°æ®æºæ•´åˆåœ¨ä¸€èµ·ï¼Œè¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚
- **æ—¥æœŸèŒƒå›´ç”Ÿæˆå™¨**ï¼šå¯ä»¥ç”Ÿæˆæ—¥æœŸèŒƒå›´ ğŸ“…ï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰æ—¥æœŸåç§»ï¼ˆå®ç°è‡ªå®šä¹‰é¢‘ç‡ï¼‰ï¼Œæ—¶é—´åºåˆ—åˆ†æå¿…å¤‡ï¼

```{python}
import pandas as pd

# ç”Ÿæˆæ—¥æœŸèŒƒå›´
date_range = pd.date_range(start='2023-01-01', end='2023-01-10')
print(date_range)

# è‡ªå®šä¹‰æ—¥æœŸåç§»
custom_dates = pd.date_range(start='2023-01-01', periods=5, freq='2D') # æ¯ä¸¤å¤©
print(custom_dates)
```

- **è¾“å…¥/è¾“å‡ºå·¥å…·**ï¼šä»å„ç§æ ¼å¼çš„æ–‡ä»¶ï¼ˆå¦‚ CSVã€Excelï¼‰ä¸­åŠ è½½è¡¨æ ¼æ•°æ®ï¼Œä»¥åŠä» PyTables/HDF5 æ ¼å¼ä¸­ä¿å­˜å’ŒåŠ è½½ Pandas å¯¹è±¡ã€‚æ•°æ®å¯¼å…¥å¯¼å‡ºï¼Œç•…é€šæ— é˜»ï¼
    -   **CSV (Comma Separated Values)**ï¼šé€—å·åˆ†éš”å€¼ï¼Œä¸€ç§å¸¸è§çš„æ–‡æœ¬æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå­˜å‚¨è¡¨æ ¼æ•°æ®ã€‚å¯ä»¥ç†è§£ä¸ºç”¨é€—å·`,`åˆ†éš”å­—æ®µï¼ˆåˆ—ï¼‰ï¼Œç”¨æ¢è¡Œç¬¦åˆ†éš”æ¯æ¡è®°å½•ï¼ˆè¡Œï¼‰çš„çº¯æ–‡æœ¬ã€‚
    -   **Delimited Files**: ä½¿ç”¨ç‰¹å®šåˆ†éš”ç¬¦ï¼ˆå¦‚åˆ¶è¡¨ç¬¦`\t`ã€ç©ºæ ¼` `ç­‰ï¼‰åˆ†éš”æ•°æ®çš„æ–‡ä»¶ã€‚
    -   **Excel 2003**: æŒ‡çš„æ˜¯ Microsoft Excel 2003 ç‰ˆæœ¬çš„æ–‡ä»¶æ ¼å¼ï¼ˆ.xlsï¼‰ã€‚ç°åœ¨æ›´å¸¸ç”¨çš„æ˜¯.xlsxæ ¼å¼ã€‚
    -   **PyTables/HDF5**: PyTables æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†åˆ†å±‚æ•°æ®é›†çš„ Python åŒ…ï¼Œè®¾è®¡ç”¨äºé«˜æ•ˆå¤„ç†å¤§é‡æ•°æ®ã€‚HDF5 (Hierarchical Data Format version 5) æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å’Œç®¡ç†æ•°æ®çš„æ–‡ä»¶æ ¼å¼ã€‚ç‰¹ç‚¹æ˜¯æ”¯æŒå­˜å‚¨éå¸¸å¤§çš„ã€å¼‚æ„çš„ã€å¤æ‚çš„æ•°æ®å¯¹è±¡ã€‚

```{python}
#| eval: false

# ä» CSV æ–‡ä»¶è¯»å–æ•°æ®
df = pd.read_csv('data.csv')

# å°†æ•°æ®ä¿å­˜ä¸º Excel æ–‡ä»¶
df.to_excel('data.xlsx', index=False)
```

- **æ ‡å‡†æ•°æ®ç»“æ„**ï¼šæ”¯æŒå­˜å‚¨å¤§é‡ç¼ºå¤±æˆ–ä¸€è‡´çš„æ•°æ®ï¼Œå°±åƒä¸€ä¸ªå¤§ä»“åº“ ğŸ­ï¼Œå¯ä»¥å®¹çº³å„ç§ç±»å‹çš„æ•°æ®ã€‚
- **ç§»åŠ¨çª—å£ç»Ÿè®¡**ï¼šå¦‚æ»šåŠ¨å¹³å‡å€¼ã€æ»šåŠ¨æ ‡å‡†åå·®ç­‰ï¼Œéå¸¸é€‚åˆå¤„ç†æ—¶é—´åºåˆ—æ•°æ®ï¼Œå°±åƒä¸€ä¸ªæ»‘åŠ¨çª—å£ ğŸªŸï¼Œå¯ä»¥è§‚å¯Ÿæ•°æ®çš„å˜åŒ–è¶‹åŠ¿ã€‚

## åŸºç¡€æ•°æ®ç»“æ„â€”â€”Series ğŸ§±

::: {.callout-tip}
**Series** æ˜¯ Pandas ä¸­ä¸€ç§é‡è¦çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äº**ä¸€ç»´æ•°ç»„**ä¸**å­—å…¸**çš„ç»“åˆã€‚å¯ä»¥çœ‹ä½œæ˜¯å¸¦æ ‡ç­¾çš„æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ ‡ç­¾ï¼ˆç´¢å¼•ï¼‰ã€‚
:::

- **å®šé•¿æœ‰åºå­—å…¸**ï¼šSeries å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®šé•¿ã€æœ‰åºçš„â€œå­—å…¸â€ç»“æ„ï¼Œé”®å€¼å¯¹ä¸€ä¸€å¯¹åº”ã€‚
- **æœ‰æ ‡ç­¾çš„ä¸€ç»´æ•°ç»„**ï¼šSeries æ˜¯ä¸€ä¸ªæœ‰æ ‡ç­¾çš„ä¸€ç»´æ•°ç»„ï¼Œæ ‡ç­¾åœ¨ Pandas ä¸­å¯¹åº”çš„æ•°æ®ç±»å‹æ˜¯ `index`ã€‚

### Seriesçš„åˆ›å»º

- é€šè¿‡ `list` åˆ›å»ºï¼š

```{python}
import pandas as pd

data = [1, 2, 3, 4, 5]  # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨
series_from_list = pd.Series(data)  # ç”¨åˆ—è¡¨åˆ›å»º Series
print(series_from_list) # æ‰“å° Series, åŒ…å«ç´¢å¼•å’Œå€¼
```
::: {.callout-note}
åˆ›å»ºSeriesæ—¶å¯ä»¥æŒ‡å®šindexï¼Œå¦‚æœæ²¡æŒ‡å®šindexï¼Œåˆ™è‡ªåŠ¨ä½¿ç”¨æ•´æ•°ç´¢å¼•ï¼Œä»0å¼€å§‹ã€‚
:::

- é€šè¿‡ `NumPy` çš„ `ndarray` åˆ›å»ºï¼š

```{python}
import pandas as pd
import numpy as np

data = np.array([1, 2, 3, 4, 5]) # åˆ›å»ºä¸€ä¸ª NumPy æ•°ç»„
series_from_ndarray = pd.Series(data)  # ç”¨ NumPy æ•°ç»„åˆ›å»º Series
print(series_from_ndarray)
```

- é€šè¿‡ `dict` åˆ›å»ºï¼š

```{python}
import pandas as pd

data = {'a': 1, 'b': 2, 'c': 3} # åˆ›å»ºä¸€ä¸ªå­—å…¸
series_from_dict = pd.Series(data)  # ç”¨å­—å…¸åˆ›å»º Series
print(series_from_dict)  # å­—å…¸çš„é”®ä¼šæˆä¸º Series çš„ç´¢å¼•
```

- é€šè¿‡æ ‡é‡åˆ›å»ºï¼š

```{python}
import pandas as pd

series_from_scalar = pd.Series(5, index=['a', 'b', 'c'])  # åˆ›å»ºä¸€ä¸ªæ‰€æœ‰å€¼éƒ½ä¸º 5 çš„ Series
print(series_from_scalar)
```

## Seriesçš„è®¿é—®å’Œæ“ä½œ

### Seriesçš„è®¿é—®

- ä½¿ç”¨ `iloc` å’Œ `loc` å‡½æ•°ï¼š
    - `iloc`ï¼šé€šè¿‡**ä½ç½®**è®¿é—®ï¼Œå°±åƒæ•°ç»„ä¸€æ ·ï¼Œä½¿ç”¨æ•´æ•°ç´¢å¼•ã€‚
    - `loc`ï¼šé€šè¿‡**æ ‡ç­¾**è®¿é—®ï¼Œå°±åƒå­—å…¸ä¸€æ ·ï¼Œä½¿ç”¨ç´¢å¼•å€¼ã€‚

```{python}
import pandas as pd

s = pd.Series([10, 20, 30], index=['a', 'b', 'c'])

# é€šè¿‡ä½ç½®è®¿é—®
print(s.iloc[0])  # è¾“å‡º: 10

# é€šè¿‡æ ‡ç­¾è®¿é—®
print(s.loc['b']) # è¾“å‡º: 20
```

- ç±»ä¼¼æ•°ç»„å’Œå±æ€§çš„è®¿é—®ï¼š

```{python}
# ç±»ä¼¼æ•°ç»„
print(s[0])  # è¾“å‡º: 10

# ç±»ä¼¼å±æ€§(å¦‚æœç´¢å¼•æ˜¯æœ‰æ•ˆçš„Pythonå˜é‡å)
print(s.a) # è¾“å‡º: 10
```

### Seriesçš„æ“ä½œ

- **å‘é‡åŒ–æ“ä½œ**ï¼šåƒæ•°ç»„ä¸€æ ·å¯¹ Series è¿›è¡Œæ“ä½œï¼Œæ— éœ€å¾ªç¯ï¼ŒPandas ä¼šè‡ªåŠ¨å¤„ç†ã€‚
- **NumPyå…¼å®¹æ€§**ï¼šNumPy ä¸­å¯¹ `ndarray` çš„æ“ä½œä¹Ÿé€‚ç”¨äº Seriesï¼Œä¾‹å¦‚åŠ å‡ä¹˜é™¤ã€æ±‚å’Œã€å¹³å‡ç­‰ã€‚
- **æ•°æ®å¯¹é½**ï¼šç”±äºç´¢å¼•çš„å­˜åœ¨ï¼ŒSeries åœ¨æ“ä½œæ—¶ä¼šè‡ªåŠ¨å¯¹é½æ•°æ®ï¼Œä¸åŒç´¢å¼•çš„æ•°æ®ä¼šè¿›è¡ŒåŒ¹é…ï¼Œæ‰¾ä¸åˆ°åŒ¹é…çš„ä¼šç”¨ `NaN` å¡«å……ã€‚

```{python}
import pandas as pd

s1 = pd.Series([1, 2, 3], index=['a', 'b', 'c'])
s2 = pd.Series([4, 5, 6], index=['b', 'c', 'd'])

print(s1 + s2)  # ç´¢å¼•å¯¹é½ï¼Œ'a' å’Œ 'd' å¯¹åº”çš„å€¼ä¸º NaN
```

## åŸºç¡€æ•°æ®ç»“æ„â€”â€”DataFrame ğŸ§±

::: {.callout-note}
**DataFrame** æ˜¯ Pandas ä¸­æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œæ˜¯æœ‰æ ‡ç­¾çš„**äºŒç»´æ•°ç»„**ï¼Œç±»ä¼¼äº**è¡¨æ ¼** ğŸ“‡ã€**SQL**ä¸­çš„ `table`ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª `Series` å¯¹è±¡çš„ `dict`ã€‚ å¯ä»¥çœ‹ä½œæ˜¯å¤šä¸ª Series å…±äº«åŒä¸€ä¸ªç´¢å¼•ã€‚
:::

- **è¡Œç´¢å¼• (index)** å’Œ **åˆ—ç´¢å¼• (columns)**ï¼šDataFrame åŒæ—¶å…·æœ‰è¡Œç´¢å¼•å’Œåˆ—ç´¢å¼•ï¼Œå°±åƒä¸€ä¸ªè¡¨æ ¼æœ‰è¡Œæ ‡é¢˜å’Œåˆ—æ ‡é¢˜ã€‚

### DataFrameçš„åˆ›å»º

- **è¾“å…¥**ï¼š
    - ä¸€ç»´ `ndarray`ã€`list`ã€`dict` æˆ– `Series` çš„ `dict`ã€‚
    - äºŒç»´ `ndarray`ã€‚
    - ä¸€ä¸ª `Series`ã€‚
    - å…¶ä»– `DataFrame`ã€‚

```{python}
import pandas as pd

# ç”¨å­—å…¸åˆ›å»º DataFrame
data = {'col1': [1, 2], 'col2': [3, 4]}
df = pd.DataFrame(data)
print(df)

# ç”¨äºŒç»´æ•°ç»„åˆ›å»º DataFrame
data = [[1, 2], [3, 4]]
df = pd.DataFrame(data, columns=['col1', 'col2'])
print(df)
```

- **ç´¢å¼•**ï¼š
    - åˆ›å»º DataFrame æ—¶ï¼Œå¯ä»¥é€šè¿‡ `index` å’Œ `columns` å‚æ•°æŒ‡å®šè¡Œç´¢å¼•å’Œåˆ—ç´¢å¼•ã€‚
    - å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä» 0 å¼€å§‹çš„æ•´æ•°ç´¢å¼•ã€‚

- **Seriesçš„dictåˆ›å»ºDataFrame**ï¼š
    - è‹¥æŒ‡å®š `index`ï¼Œä¼šä¸¢å¼ƒæ‰€æœ‰æœªå’ŒæŒ‡å®š `index` åŒ¹é…çš„æ•°æ®ã€‚

```{python}
import pandas as pd

data = {'col1': pd.Series([1, 2, 3], index=['a', 'b', 'c']),
        'col2': pd.Series([1, 2, 3, 4], index=['a', 'b', 'c', 'd'])}
df = pd.DataFrame(data)  # å­—å…¸çš„é”®ä¼šæˆä¸º DataFrame çš„åˆ—å
print(df) # indexè‡ªåŠ¨å–å¹¶é›†

df = pd.DataFrame(data, index=['a','b'])
print(df) # indexå‚æ•°ä¸º['a','b']ï¼Œdfåªæœ‰'a','b'ä¸¤è¡Œï¼ŒæŠ›å¼ƒäº†'c'å’Œ'd'è¡Œçš„æ•°æ®
```
::: {.callout-note}
ç”¨Seriesçš„å­—å…¸åˆ›å»ºDataFrameæ—¶ï¼Œindexå¦‚æœä¸æŒ‡å®šï¼Œä¼šè‡ªåŠ¨å–å¹¶é›†ã€‚
:::

## DataFrameçš„è®¿é—®å’Œæ“ä½œ

### DataFrameçš„è®¿é—®

- å¤šç§è®¿é—®æ–¹å¼:
  - é€šè¿‡**åˆ—ç´¢å¼•**è®¿é—®ï¼š
  ```{python}
    #| eval: false
    df['column_label']
  ```
  - é€šè¿‡**è¡Œç´¢å¼•**è®¿é—®ï¼š
  ```{python}
    #| eval: false
    df.loc['row_label']
  ```
  - `loc`: é€šè¿‡**è¡Œæ ‡ç­¾**è®¿é—®
    ```{python}
    #| eval: false
    print(df.loc['row_label'])
    ```
  -  `iloc`ï¼šé€šè¿‡**è¡Œä½ç½®**è®¿é—®ã€‚
     ```{python}
     #| eval: false
     print(df.iloc[row_position])
     ```

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data, index=['A', 'B', 'C'])

# é€šè¿‡åˆ—ç´¢å¼•è®¿é—®
print(df['col1'])  # é€‰æ‹© 'col1' åˆ—

# é€šè¿‡ loc è®¿é—®
print(df.loc['A'])  # é€‰æ‹© 'A' è¡Œ

# é€šè¿‡ iloc è®¿é—®
print(df.iloc[0])  # é€‰æ‹©ç¬¬ä¸€è¡Œ
```

### DataFrameçš„æ“ä½œ

- **ç®—æœ¯æ“ä½œ**ï¼šæ”¯æŒåŠ ã€å‡ã€ä¹˜ã€é™¤ã€è½¬ç½®ç­‰ï¼Œå°±åƒæ“ä½œçŸ©é˜µä¸€æ ·ã€‚
- **NumPyå…¼å®¹æ€§**ï¼šNumPy ä¸­å¯¹çŸ©é˜µçš„æ“ä½œä¹Ÿé€‚ç”¨äº DataFrameã€‚
- **æ•°æ®å¯¹é½**ï¼šDataFrame åœ¨æ“ä½œæ—¶ä¼šè‡ªåŠ¨æŒ‰è¡Œå’Œåˆ—ç´¢å¼•å¯¹é½æ•°æ®ï¼Œä¸åŒç´¢å¼•çš„æ•°æ®ä¼šè¿›è¡ŒåŒ¹é…ï¼Œæ‰¾ä¸åˆ°åŒ¹é…çš„ä¼šç”¨ `NaN` å¡«å……ã€‚
- **å¢åˆ æ”¹æŸ¥**ï¼šå¯ä»¥å¯¹ DataFrame è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œã€‚

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data)

# æ·»åŠ ä¸€åˆ—
df['col3'] = [7, 8, 9]

# åˆ é™¤ä¸€åˆ—
df = df.drop('col2', axis=1)

# ä¿®æ”¹æ•°æ®
df.loc[0, 'col1'] = 10

# æŸ¥è¯¢æ•°æ®
print(df[df['col1'] > 1])
print(df)
```

## åŸºäºPandasçš„Indexå¯¹è±¡çš„è®¿é—®æ“ä½œ ğŸ”

### Pandasçš„Indexå¯¹è±¡

- `Series` ä¸­çš„ `index` å±æ€§ã€‚
- `DataFrame` ä¸­çš„ `index` å±æ€§å’Œ `columns` å±æ€§ã€‚
  
::: {.callout-note}
`Series` å’Œ `DataFrame` çš„ç´¢å¼•éƒ½æ˜¯ `Index` å¯¹è±¡ï¼Œç”¨äºæ ‡è¯†å’Œè®¿é—®æ•°æ®ã€‚
:::

### Indexå¯¹è±¡çš„ç‰¹å¾

- **ä¸å¯ä¿®æ”¹** (Immutable)ï¼šIndex å¯¹è±¡ä¸€æ—¦åˆ›å»ºï¼Œå°±ä¸èƒ½ä¿®æ”¹ï¼Œä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚
- **æœ‰åº**ï¼šIndex å¯¹è±¡ä¸­çš„å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥æŒ‰ç…§é¡ºåºè®¿é—®ã€‚
- **å¯åˆ‡ç‰‡**ï¼šå¯ä»¥åƒåˆ—è¡¨æˆ–æ•°ç»„ä¸€æ ·å¯¹ Index å¯¹è±¡è¿›è¡Œåˆ‡ç‰‡æ“ä½œï¼Œæ–¹ä¾¿è·å–éƒ¨åˆ†æ•°æ®ã€‚

### Indexå¯¹è±¡çš„ç±»å‹

- **Index**ï¼šæœ€æ³›åŒ–çš„ Index ç±»å‹ï¼Œå°†è½´æ ‡ç­¾è¡¨ç¤ºä¸ºä¸€ä¸ªç”± Python å¯¹è±¡ç»„æˆçš„ NumPy æ•°ç»„ã€‚
- **Int64Index**ï¼šé’ˆå¯¹æ•´æ•°çš„ Index ç±»å‹ï¼Œç”¨äºæ•´æ•°ç´¢å¼•ã€‚
- **MultiIndex**ï¼šé’ˆå¯¹å¤šå±‚ç´¢å¼•çš„ Index ç±»å‹ï¼Œç”¨äºåˆ›å»ºå¤æ‚çš„å±‚æ¬¡åŒ–ç´¢å¼•ã€‚
- **DatetimeIndex**ï¼šå­˜å‚¨æ—¶é—´æˆ³çš„ Index ç±»å‹ï¼Œç”¨äºæ—¶é—´åºåˆ—æ•°æ®ã€‚
- **PeriodIndex**ï¼šé’ˆå¯¹æ—¶é—´é—´éš”æ•°æ®çš„ Index ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºä¸€æ®µæ—¶é—´ã€‚

## Indexå¯¹è±¡çš„åŸºæœ¬æ“ä½œ ğŸ§®

| å‡½æ•°           | è¯´æ˜                                                                  |
| -------------- | --------------------------------------------------------------------- |
| `delete`       | åˆ é™¤ç´¢å¼• `i` å¤„çš„å…ƒç´ ï¼Œè¿”å›æ–°çš„ Index å¯¹è±¡ï¼ˆå¯ä»¥ä¼ å…¥ç´¢å¼•çš„æ•°ç»„ï¼‰          |
| `drop`         | åˆ é™¤ä¼ å…¥çš„å…ƒç´  `e`ï¼Œè¿”å›æ–°çš„ Index å¯¹è±¡ï¼ˆå¯ä»¥ä¼ å…¥å…ƒç´ çš„æ•°ç»„ï¼‰            |
| `insert`       | å°†å…ƒç´ æ’å…¥ç´¢å¼• `i` å¤„ï¼Œè¿”å›æ–°çš„ Index å¯¹è±¡                             |
| `append`       | è¿æ¥å¦ä¸€ä¸ª Index å¯¹è±¡ï¼Œè¿”å›æ–°çš„ Index å¯¹è±¡                               |
| `union`        | ä¸å¦ä¸€ä¸ª Index å¯¹è±¡è¿›è¡Œå¹¶æ“ä½œï¼Œè¿”å›ä¸¤è€…çš„å¹¶é›†                             |
| `difference`   | ä¸å¦ä¸€ä¸ª Index å¯¹è±¡è¿›è¡Œå·®æ“ä½œï¼Œè¿”å›ä¸¤è€…çš„å·®é›†                             |
| `intersection` | ä¸å¦ä¸€ä¸ª Index å¯¹è±¡è¿›è¡Œäº¤æ“ä½œï¼Œè¿”å›ä¸¤è€…çš„äº¤é›†                             |
| `isin`         | åˆ¤æ–­ Index å¯¹è±¡ä¸­æ¯ä¸ªå…ƒç´ æ˜¯å¦åœ¨å‚æ•°æ‰€ç»™çš„æ•°ç»„ç±»å‹å¯¹è±¡ä¸­ï¼Œè¿”å›ä¸€ä¸ªä¸ Index å¯¹è±¡é•¿åº¦ç›¸åŒçš„ Bool æ•°ç»„ |
| `is_monotonic` | å½“æ¯ä¸ªå…ƒç´ éƒ½å¤§äºå‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¿”å› `True`                                |
| `is_unique`    | å½“ Index å¯¹è±¡ä¸­æ²¡æœ‰é‡å¤å€¼æ—¶ï¼Œè¿”å› `True`                                  |
| `unique`       | è¿”å›æ²¡æœ‰é‡å¤æ•°æ®çš„ Index å¯¹è±¡                                             |

```{python}
#| eval: false

import pandas as pd

index = pd.Index(['a', 'b', 'c', 'd'])

# åˆ é™¤ç´¢å¼•ä¸º 1 çš„å…ƒç´ 
new_index = index.delete(1)  # new_index: Index(['a', 'c', 'd'], dtype='object')

# åˆ é™¤å…ƒç´  'c'
new_index = index.drop('c')  # new_index: Index(['a', 'b', 'd'], dtype='object')

# æ’å…¥å…ƒç´  'e' åˆ°ç´¢å¼• 2
new_index = index.insert(2, 'e')  # new_index: Index(['a', 'b', 'e', 'c', 'd'], dtype='object')

# è¿æ¥å¦ä¸€ä¸ª Index å¯¹è±¡
other_index = pd.Index(['e', 'f'])
new_index = index.append(other_index)  # new_index: Index(['a', 'b', 'c', 'd', 'e', 'f'], dtype='object')
```

## ç´¢å¼•çš„ä¸åŒè®¿é—®æ–¹å¼

### loc æ–¹å¼

- å…³æ³¨ `index` çš„ **label**ï¼Œç­›é€‰æ¡ä»¶ä¸ `label` ç›¸å…³ã€‚
- æ¥æ”¶ `index` çš„ `label` ä½œä¸ºå‚æ•°è¾“å…¥ã€‚
- å¯ä»¥æ¥æ”¶ï¼š
  - å•ä¸ª `label`ã€‚
  - `label` çš„æ•°ç»„ã€‚
  - `label` çš„åˆ†ç‰‡ (`slice`)ã€‚
  - å¸ƒå°”æ•°ç»„ã€‚
  - å›è°ƒå‡½æ•°ï¼ˆå‚æ•°ä¸ºè°ƒç”¨ `loc` å‡½æ•°çš„å¯¹è±¡ï¼Œå³ `Series` æˆ– `DataFrame`ï¼‰ã€‚

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data, index=['A', 'B', 'C'])

# å•ä¸ª label
print(df.loc['A'])

# label æ•°ç»„
print(df.loc[['A', 'C']])

# label åˆ†ç‰‡
print(df.loc['A':'B'])

# å¸ƒå°”æ•°ç»„
print(df.loc[df['col1'] > 1])

# å›è°ƒå‡½æ•°
print(df.loc[lambda df: df['col2'] > 4])
```

### iloc æ–¹å¼

- å…³æ³¨ `index` çš„ **position**ã€‚
- æ¥æ”¶ `index` çš„ `position` ä½œä¸ºå‚æ•°è¾“å…¥ã€‚
- å¯ä»¥æ¥æ”¶ï¼š
    - å•ä¸ªæ•´æ•°ï¼ˆè¡¨ç¤º `position`ï¼‰ã€‚
    - `position` çš„æ•°ç»„ã€‚
    - `position` çš„åˆ†ç‰‡ (`slice`)ã€‚
    - å¸ƒå°”æ•°ç»„ã€‚
    - å›è°ƒå‡½æ•°ï¼ˆå‚æ•°ä¸ºè°ƒç”¨ `iloc` å‡½æ•°çš„å¯¹è±¡ï¼Œå³ `Series` æˆ– `DataFrame`ï¼‰ã€‚

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data, index=['A', 'B', 'C'])

# å•ä¸ªæ•´æ•°
print(df.iloc[0])

# position æ•°ç»„
print(df.iloc[[0, 2]])

# position åˆ†ç‰‡
print(df.iloc[0:2])

# å¸ƒå°”æ•°ç»„
print(df.iloc[(df['col1'] > 1).values])

# å›è°ƒå‡½æ•°
print(df.iloc[lambda df: [0, 2]])  # æ³¨æ„ï¼šè¿™é‡Œçš„å›è°ƒå‡½æ•°è¿”å›çš„æ˜¯ä½ç½®åˆ—è¡¨
```

### ç±»ä¼¼dictæ–¹å¼çš„è®¿é—®

- å¯ä»¥å°† `Series` å’Œ `DataFrame` çœ‹ä½œ `dict`ã€‚
- `DataFrame` ç›¸å½“äºæ¯ä¸ªå…ƒç´ æ˜¯ `Series` çš„ `dict`ã€‚
- å¯ä»¥ç”¨ç±»ä¼¼ `dict` è®¿é—®çš„æ–¹å¼æ¥è®¿é—® `Series` å’Œ `DataFrame`ã€‚

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data)

# è®¿é—® 'col1' åˆ—
print(df['col1'])  # ç±»ä¼¼äºè®¿é—®å­—å…¸çš„é”®

# å¯¹äº Seriesï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç´¢å¼•è®¿é—®
s = pd.Series([10, 20, 30], index=['a', 'b', 'c'])
print(s['b'])
```

### ç±»ä¼¼å±æ€§æ–¹å¼çš„è®¿é—®

- æ¥å—å‚æ•°ç±»å‹åŒ…æ‹¬ï¼š
  - å•ä¸ªå˜é‡
  - æ•°ç»„å½¢å¼ï¼ˆ`list` æˆ–è€… `NumPy` çš„ `ndarray`ï¼‰
  - å¸ƒå°”æ•°ç»„
  - å›è°ƒå‡½æ•°ã€‚

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data, index=['A', 'B', 'C'])

# å•ä¸ªå˜é‡
print(df.col1)  # è®¿é—® 'col1' åˆ—ï¼Œç±»ä¼¼äºè®¿é—®å¯¹è±¡çš„å±æ€§

# æ•°ç»„å½¢å¼
print(df[['col1', 'col2']])

# å¸ƒå°”æ•°ç»„
print(df[df.col1 > 1])  # ä½¿ç”¨å¸ƒå°”æ•°ç»„ç­›é€‰æ•°æ®

# å›è°ƒå‡½æ•°
print(df[lambda df: df.col2 > 4])
```

## è°ƒç”¨æ–¹å¼é—´çš„åŒºåˆ«

### locå‡½æ•°å’Œilocå‡½æ•°çš„åŒºåˆ«

- `loc` å‡½æ•°å’Œ `iloc` å‡½æ•°éƒ½æ˜¯å¯¹ `index` çš„è®¿é—®ã€‚
- å¯¹äº `DataFrame`ï¼Œä¹Ÿå¯ä»¥å®ç°å¯¹æŸä¸ª `index` ä¸‹çš„æŸä¸ª `column` çš„è®¿é—®ã€‚
- æ¥æ”¶çš„æ•°æ®ç±»å‹ç›¸åŒï¼Œä½†å«ä¹‰ä¸åŒï¼š
  - `loc` å‡½æ•°æ¥æ”¶ `Index` å¯¹è±¡ï¼ˆ`index` å’Œ `columns`ï¼‰çš„ `label`ã€‚
  - `iloc` å‡½æ•°æ¥æ”¶ `Index` å¯¹è±¡ï¼ˆ`index` å’Œ `columns`ï¼‰çš„ `position`ã€‚

### é€šè¿‡locè®¿é—®å’Œé€šè¿‡[]è®¿é—®çš„åŒºåˆ«

- `loc` å‡½æ•°å’Œ `[]` éƒ½æ¥æ”¶ `Index` å¯¹è±¡ï¼ˆ`index` å’Œ `columns`ï¼‰çš„ `label` ä½œä¸ºå‚æ•°ã€‚
- `loc` å‡½æ•°æ˜¯å¯¹ `index` çš„è®¿é—®ã€‚
- `[]` åœ¨ `DataFrame` ä¸­æ˜¯å¯¹ `columns` çš„è®¿é—®ï¼Œåœ¨ `Series` ä¸­æ— å·®åˆ«ã€‚

## ç‰¹æ®Šçš„è¾“å…¥ç±»å‹

### è¾“å…¥ä¸ºå¸ƒå°”ç±»å‹æ•°ç»„

- ä½¿ç”¨å¸ƒå°”ç±»å‹æ•°ç»„ä½œä¸ºè¾“å…¥å‚æ•°ä¹Ÿæ˜¯å¸¸è§çš„æ“ä½œä¹‹ä¸€ã€‚
- å¯ç”¨çš„è¿ç®—ç¬¦åŒ…æ‹¬ï¼š
  - `|` (æˆ–è¿ç®—)
  - `&` (ä¸è¿ç®—)
  - `~` (éè¿ç®—)
- **æ³¨æ„**ï¼šè¦ä½¿ç”¨åœ†æ‹¬å· `()` æ¥ç»„åˆæ¡ä»¶ã€‚

```{python}
import pandas as pd

df = pd.DataFrame({'col1': [1, 2, 3], 'col2': [4, 5, 6]})

# é€‰å– col1 å¤§äº 1 ä¸” col2 å°äº 6 çš„è¡Œ
print(df[(df['col1'] > 1) & (df['col2'] < 6)])

# é€‰å– col1 ç­‰äº 1 æˆ– col2 å¤§äº 5 çš„è¡Œ
print(df[(df['col1'] == 1) | (df['col2'] > 5)])
```

### è¾“å…¥ä¸ºå›è°ƒå‡½æ•°

- `loc`ã€`iloc` å’Œ `[]` éƒ½æ¥æ”¶å›è°ƒå‡½æ•°ä½œä¸ºè¾“å…¥æ¥è¿›è¡Œè®¿é—®ã€‚
- å›è°ƒå‡½æ•°å¿…é¡»ä»¥è¢«è®¿é—®çš„ `Series` æˆ–è€… `DataFrame` ä½œä¸ºå‚æ•°ã€‚

```{python}
import pandas as pd

df = pd.DataFrame({'col1': [1, 2, 3], 'col2': [4, 5, 6]})

# ä½¿ç”¨å›è°ƒå‡½æ•°é€‰å– col2 å¤§äº 4 çš„è¡Œ
print(df[lambda df: df['col2'] > 4])

# ä½¿ç”¨ loc å’Œå›è°ƒå‡½æ•°é€‰å– col1 å¤§äº 1 çš„è¡Œ
print(df.loc[lambda df: df['col1'] > 1])

# ä½¿ç”¨ iloc å’Œå›è°ƒå‡½æ•°é€‰å–ç¬¬ 0 è¡Œå’Œç¬¬ 2 è¡Œ
print(df.iloc[lambda df: [0, 2]])
```

## æ•°å­¦ç»Ÿè®¡å’Œè®¡ç®—å·¥å…· ğŸ§®

### ç»Ÿè®¡å‡½æ•°

- Pandas æä¾›äº†ä¸€ç³»åˆ—ç»Ÿè®¡å‡½æ•°æ¥å£ï¼Œæ–¹ä¾¿ç”¨æˆ·ç›´æ¥è¿›è¡Œç»Ÿè®¡è¿ç®—ã€‚
- åŒ…æ‹¬ï¼š
  - **åæ–¹å·®:** ç”¨äºè¡¡é‡ä¸¤ä¸ªå˜é‡çš„æ€»ä½“è¯¯å·®ã€‚å½“ä¸¤ä¸ªå˜é‡çš„å˜åŒ–è¶‹åŠ¿ä¸€è‡´æ—¶ï¼Œåæ–¹å·®ä¸ºæ­£ï¼›å½“å˜åŒ–è¶‹åŠ¿ç›¸åæ—¶ï¼Œåæ–¹å·®ä¸ºè´Ÿï¼›å¦‚æœä¸¤ä¸ªå˜é‡ç›¸äº’ç‹¬ç«‹ï¼Œåˆ™åæ–¹å·®ä¸º0ã€‚
  - **ç›¸å…³ç³»æ•°:** ç”¨äºç ”ç©¶å˜é‡ä¹‹é—´çº¿æ€§ç›¸å…³ç¨‹åº¦çš„é‡ã€‚ç›¸å…³ç³»æ•°çš„å–å€¼èŒƒå›´åœ¨-1åˆ°1ä¹‹é—´ï¼Œç»å¯¹å€¼è¶Šå¤§ï¼Œè¯´æ˜å˜é‡ä¹‹é—´çš„çº¿æ€§ç›¸å…³æ€§è¶Šå¼ºã€‚
  - **æ’åº:** å¯¹æ•°æ®è¿›è¡Œæ’åºã€‚

- Pandas æä¾›äº†ï¼š
  - ä¸¤ä¸ª `Series` å¯¹è±¡ä¹‹é—´çš„åæ–¹å·®è®¡ç®—æ¥å£ã€‚
  - ä¸€ä¸ª `DataFrame` çš„åæ–¹å·®çŸ©é˜µçš„è®¡ç®—æ¥å£ã€‚

```{python}
import pandas as pd

s1 = pd.Series([1, 2, 3, 4, 5])
s2 = pd.Series([2, 3, 1, 5, 4])

# è®¡ç®— s1 å’Œ s2 çš„åæ–¹å·®
covariance = s1.cov(s2)
print(f"åæ–¹å·®: {covariance}")

# è®¡ç®— s1 å’Œ s2 çš„ç›¸å…³ç³»æ•°
correlation = s1.corr(s2)
print(f"ç›¸å…³ç³»æ•°: {correlation}")

df = pd.DataFrame({'col1': [1, 2, 3], 'col2': [4, 5, 6]})

# è®¡ç®— DataFrame çš„åæ–¹å·®çŸ©é˜µ
cov_matrix = df.cov()
print(f"åæ–¹å·®çŸ©é˜µ:\n{cov_matrix}")

# è®¡ç®— DataFrame çš„ç›¸å…³ç³»æ•°çŸ©é˜µ
corr_matrix = df.corr()
print(f"ç›¸å…³ç³»æ•°çŸ©é˜µ:\n{corr_matrix}")
```

## çª—å£å‡½æ•°

::: {.callout-tip}
åœ¨ç§»åŠ¨çª—å£ä¸Šè®¡ç®—ç»Ÿè®¡å‡½æ•°å¯¹äºå¤„ç†**æ—¶åºæ•°æ®** ğŸ“ˆ éå¸¸å¸¸è§ã€‚
:::

- Pandas æä¾›äº†ä¸€ç³»åˆ—çª—å£å‡½æ•°ï¼ŒåŒ…æ‹¬ï¼š
  - è®¡æ•°
  - æ±‚å’Œ
  - æ±‚å¹³å‡
  - ä¸­ä½æ•°
  - ç›¸å…³ç³»æ•°
  - æ–¹å·®
  - åæ–¹å·®
  - æ ‡å‡†å·®
  - åæ–œåº¦
  - å³°åº¦
- çª—å£å¯¹è±¡ï¼š
  - **Rolling**:
    - å®šé•¿çš„çª—å£ã€‚
    - éœ€è¦é€šè¿‡å‚æ•° `window` æŒ‡å®šçª—å£å¤§å°ã€‚
  - **Expanding**:
    - æ‰©å±•çª—å£ã€‚
    - ç¬¬ `i` ä¸ªçª—å£çš„å¤§å°ä¸º `i`ã€‚
    - å¯ä»¥å°†å…¶çœ‹ä½œç‰¹æ®Šçš„ `windows` ä¸ºæ•°æ®é•¿åº¦ã€`min_periods` ä¸º 1 çš„ `Rolling` å¯¹è±¡ã€‚
  - **EWM (Exponentially Weighted Moving)**:
    - æŒ‡æ•°åŠ æƒçª—å£ã€‚
    - éœ€è¦å®šä¹‰è¡°å‡å› å­ Î±ã€‚
    - å®šä¹‰æ–¹å¼ï¼š
      - æ—¶é—´é—´éš” `span`ã€‚
      - è´¨å¿ƒ `center of mass`ã€‚
      - åŠè¡°æœŸ `half-life`ï¼ˆæŒ‡æ•°æƒé‡å‡å°‘åˆ°ä¸€åŠéœ€è¦çš„æ—¶é—´ï¼‰ã€‚
      - ç›´æ¥å®šä¹‰ `alpha`ã€‚

```{python}
import pandas as pd

# åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—
s = pd.Series([1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
              index=pd.date_range('2023-01-01', periods=10, freq='D'))

# Rolling çª—å£
rolling_mean = s.rolling(window=3).mean()  # è®¡ç®— 3 å¤©çš„æ»šåŠ¨å¹³å‡å€¼
print(f"æ»šåŠ¨å¹³å‡:\n{rolling_mean}")

# Expanding çª—å£
expanding_sum = s.expanding().sum()  # è®¡ç®—ç´¯è®¡å’Œ
print(f"ç´¯è®¡å’Œ:\n{expanding_sum}")

# EWM çª—å£
ewm_mean = s.ewm(span=3).mean()  # è®¡ç®—æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡å€¼
print(f"æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡:\n{ewm_mean}")
```

## çª—å£å¯¹è±¡çš„ç»Ÿè®¡å‡½æ•° ğŸ“Š

| å‡½æ•°         | è¯´æ˜                                                                 |
| ------------ | -------------------------------------------------------------------- |
| `count()`    | ç§»åŠ¨çª—å£å†…é `NaN` å€¼çš„è®¡æ•°                                              |
| `sum()`      | ç§»åŠ¨çª—å£å†…çš„å’Œ                                                         |
| `mean()`     | ç§»åŠ¨çª—å£å†…çš„å¹³å‡å€¼                                                     |
| `median()`   | ç§»åŠ¨çª—å£å†…çš„ä¸­ä½æ•°                                                     |
| `min()`      | ç§»åŠ¨çª—å£å†…çš„æœ€å°å€¼                                                     |
| `max()`      | ç§»åŠ¨çª—å£å†…çš„æœ€å¤§å€¼                                                     |
| `std()`      | ç§»åŠ¨çª—å£å†…çš„æ— åä¼°è®¡æ ‡å‡†å·®ï¼ˆåˆ†æ¯ä¸º `n-1`ï¼‰                                |
| `var()`      | ç§»åŠ¨çª—å£å†…çš„æ— åä¼°è®¡æ–¹å·®ï¼ˆåˆ†æ¯ä¸º `n-1`ï¼‰                                |
| `skew()`     | ç§»åŠ¨çª—å£å†…çš„ååº¦  (æ ·æœ¬çš„ä¸‰é˜¶æ ‡å‡†åŒ–çŸ©)                                                      |
| `kurt()`     | ç§»åŠ¨çª—å£å†…çš„å³°åº¦   (æ ·æœ¬çš„å››é˜¶æ ‡å‡†åŒ–çŸ©)                                                      |
| `quantile()` | ç§»åŠ¨çª—å£å†…çš„æŒ‡å®šåˆ†ä½æ•°ä½ç½®çš„å€¼ï¼ˆä¼ å…¥çš„åº”è¯¥æ˜¯ `[0,1]` çš„å€¼ï¼‰                 |
| `apply()`    | åœ¨ç§»åŠ¨çª—å£å†…ä½¿ç”¨æ™®é€šçš„ï¼ˆå¯ä»¥è‡ªå®šä¹‰çš„ï¼‰æ•°ç»„å‡½æ•°                           |
| `cov()`      | ç§»åŠ¨çª—å£å†…çš„åæ–¹å·®                                                     |
| `corr()`     | ç§»åŠ¨çª—å£å†…çš„ç›¸å…³ç³»æ•°                                                   |

## æ•°å­¦èšåˆå’Œåˆ†ç»„è¿ç®— â•â–

::: {.callout-note}
ç±»ä¼¼äº SQL æ“ä½œä¸­çš„åˆ†ç»„å’Œèšåˆï¼ŒPandas æä¾›äº† `groupby` åŠŸèƒ½ã€‚
:::

- `groupby` åŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼š
  1. **split**ï¼šæ ¹æ®ä¸€å®šåŸåˆ™å°†æ•°æ®åˆ†ç»„ã€‚
  2. **apply**ï¼šæ¯ä¸ªç»„åˆ†åˆ«æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°å€¼ã€‚
  3. **combine**ï¼šå°†å„ç»„çš„ç»“æœåˆå¹¶åˆ°æœ€ç»ˆå¯¹è±¡ä¸­ã€‚

- **æ‹†åˆ†æ“ä½œ**ï¼š
  - Pandas å¯¹è±¡ï¼ˆ`Series` æˆ– `DataFrame`ï¼‰æ ¹æ®æä¾›çš„é”®åœ¨ç‰¹å®šçš„è½´ä¸Šè¿›è¡Œæ‹†åˆ†ã€‚
  - `DataFrame` å¯ä»¥æŒ‡å®šæ˜¯åœ¨ `index` è½´è¿˜æ˜¯ `columns` è½´ã€‚

## æ‹†åˆ†é”®çš„å½¢å¼

| æ‹†åˆ†é”®çš„å½¢å¼è¯´æ˜                       | ç¤ºä¾‹                                                                  |
| :------------------------------------- | :-------------------------------------------------------------------- |
| å’Œæ‰€é€‰è½´é•¿åº¦ç›¸åŒçš„æ•°ç»„ï¼ˆ`list` æˆ– NumPy çš„ `array`ï¼Œç”šè‡³æ˜¯ä¸€ä¸ª `Series` å¯¹è±¡ï¼‰ | `df.groupby(group_list).count()`                                       |
| `DataFrame` æŸä¸ªåˆ—åçš„å€¼æˆ–åˆ—åçš„ `list`          | `df.groupby('a')`  `df.groupby(df['a'])`                                             |
|                                        | `# ä¸Šè¿°ä¸¤ä¸ªè¡¨è¿°ç­‰ä»·`                                                          |
|                                        |`group_series = pd.Series(group_list)`  `df.groupby(group_series)`    |
| å‚æ•°ä¸º `axis` çš„æ ‡ç­¾çš„å‡½æ•°               | `df.groupby(df.loc['one'],axis=1)`                                   |
|                                        | `def get_index_number(index):`<br> `if index in ['one','two']:` <br>   `return 'small'` <br> `else:` <br>  `return 'big'` <br> `df.groupby(get_index_number)`|
| å­—å…¸æˆ–è€… `Series`ï¼Œç»™å‡º `axis` ä¸Šçš„å€¼ä¸åˆ†ç»„åä¹‹é—´çš„å¯¹åº”å…³ç³»          |`#è¯¥ç¤ºä¾‹ä¸Demo1çš„æ•ˆæœç›¸åŒ`<br>  `group_list = ['one','two','one','two','two']` <br> `group_series = pd.Series(group_list,index = df.index)` <br> `df.groupby(group_series)`                                         |
| ç»„1ã€2ã€3ã€4çš„ `list` æˆ–è€…              | `df.groupby(['a','b'])`                                               |

```{python}
import pandas as pd

data = {'col1': ['A', 'A', 'B', 'B', 'A'],
        'col2': [1, 2, 3, 4, 5],
        'col3': [6, 7, 8, 9, 10]}

df = pd.DataFrame(data)

# æŒ‰ 'col1' åˆ†ç»„ï¼Œè®¡ç®—æ¯ç»„çš„å¹³å‡å€¼
grouped = df.groupby('col1')
print(grouped.mean())

# æŒ‰ 'col1' å’Œ 'col2' åˆ†ç»„ï¼Œè®¡ç®—æ¯ç»„çš„æ€»å’Œ
grouped = df.groupby(['col1', 'col2'])
print(grouped.sum())

# ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°åˆ†ç»„
def custom_group(index):
  if index < 2:
    return 'group1'
  else:
    return 'group2'

grouped = df.groupby(custom_group)
print(grouped.mean())
```

## åº”ç”¨éƒ¨åˆ†

- ä¸»è¦å®ç°ä»¥ä¸‹ä¸‰ç±»æ“ä½œï¼š
  1. **èšåˆæ“ä½œ**ï¼šå¯¹äºæ¯ä¸ªç»„ç»è¿‡è®¡ç®—å¾—åˆ°ä¸€ä¸ªæ¦‚è¦æ€§è´¨çš„ç»Ÿè®¡å€¼ï¼Œä¾‹å¦‚æ±‚å’Œã€æ±‚å¹³å‡ç­‰ã€‚
  2. **è½¬æ¢æ“ä½œ**ï¼šå¯¹äºæ¯ä¸ªç»„ç»è¿‡è®¡ç®—å¾—åˆ°å’Œç»„çš„é•¿åº¦ç›¸åŒçš„ä¸€ç³»åˆ—çš„å€¼ï¼Œä¾‹å¦‚å¯¹æ•°æ®çš„æ ‡å‡†åŒ–ã€å¡«å…… `NA` å€¼ç­‰ã€‚
  3. **è¿‡æ»¤æ“ä½œ**ï¼šé€šè¿‡å¯¹æ¯ä¸ªç»„çš„è®¡ç®—å¾—åˆ°ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å€¼å®Œæˆå¯¹ç»„çš„ç­›é€‰ï¼Œä¾‹å¦‚é€šè¿‡æ±‚å¾—ç»„çš„å¹³å‡å€¼æ¥ç­›é€‰ç»„ï¼Œæˆ–è€…æ¯ä¸ªç»„å†…é€šè¿‡ä¸€å®šçš„æ¡ä»¶è¿›è¡Œç­›é€‰ã€‚

```{python}
import pandas as pd

data = {'group': ['A', 'A', 'B', 'B', 'A'],
        'value': [1, 2, 3, 4, 5]}
df = pd.DataFrame(data)

# èšåˆï¼šè®¡ç®—æ¯ç»„çš„æ€»å’Œ
grouped_sum = df.groupby('group').sum()
print(f"èšåˆ - æ¯ç»„æ€»å’Œ:\n{grouped_sum}")

# è½¬æ¢ï¼šå¯¹æ¯ç»„è¿›è¡Œæ ‡å‡†åŒ–
normalized = df.groupby('group')['value'].transform(lambda x: (x - x.mean()) / x.std())
print(f"è½¬æ¢ - æ ‡å‡†åŒ–:\n{normalized}")

# è¿‡æ»¤ï¼šç­›é€‰å‡º value å¹³å‡å€¼å¤§äº 2 çš„ç»„
filtered = df.groupby('group').filter(lambda x: x['value'].mean() > 2)
print(f"è¿‡æ»¤ - å¹³å‡å€¼å¤§äº 2 çš„ç»„:\n{filtered}")
```

## æ€»ç»“ ğŸ“

- Pandas æ˜¯ Python æ•°æ®åˆ†æçš„é‡è¦å·¥å…·ï¼Œæä¾›äº† `Series` å’Œ `DataFrame` ä¸¤ç§æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚
- Pandas å…·æœ‰å¼ºå¤§çš„æ•°æ®è®¿é—®ã€æ“ä½œã€ç»Ÿè®¡å’Œåˆ†ç»„åŠŸèƒ½ã€‚
- ç†è§£ `loc`ã€`iloc` å’Œ `[]` çš„åŒºåˆ«å¯¹äºé«˜æ•ˆä½¿ç”¨ Pandas è‡³å…³é‡è¦ã€‚
- çª—å£å‡½æ•°æ˜¯å¤„ç†æ—¶åºæ•°æ®çš„æœ‰åŠ›å·¥å…·ã€‚
- `groupby` åŠŸèƒ½å¯ä»¥å®ç°ç±»ä¼¼äº SQL çš„åˆ†ç»„èšåˆæ“ä½œã€‚

## æ€è€ƒä¸è®¨è®º ğŸ¤”

- åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼ˆ`Series` æˆ– `DataFrame`ï¼‰ï¼Ÿ
  - å½“åªéœ€è¦å¤„ç†ä¸€ç»´æ•°æ®ï¼Œæˆ–è€…éœ€è¦ä¸€ä¸ªå¸¦æ ‡ç­¾çš„æ•°ç»„æ—¶ï¼Œé€‰æ‹© `Series`ã€‚
  - å½“éœ€è¦å¤„ç†äºŒç»´æ•°æ®ï¼Œæˆ–è€…éœ€è¦ä¸€ä¸ªè¡¨æ ¼ç»“æ„æ—¶ï¼Œé€‰æ‹© `DataFrame`ã€‚
- `loc` å’Œ `iloc` åœ¨ä½¿ç”¨åœºæ™¯ä¸Šæœ‰å“ªäº›åŒºåˆ«ï¼Ÿ
  - å½“éœ€è¦é€šè¿‡æ ‡ç­¾è®¿é—®æ•°æ®æ—¶ï¼Œä½¿ç”¨ `loc`ã€‚
  - å½“éœ€è¦é€šè¿‡ä½ç½®è®¿é—®æ•°æ®æ—¶ï¼Œä½¿ç”¨ `iloc`ã€‚
- å¦‚ä½•åˆ©ç”¨ Pandas çš„çª—å£å‡½æ•°åˆ†æè‚¡ç¥¨æ•°æ®ï¼Ÿ
  - å¯ä»¥ä½¿ç”¨ `rolling` å‡½æ•°è®¡ç®—ç§»åŠ¨å¹³å‡çº¿ã€ç§»åŠ¨æ ‡å‡†å·®ç­‰æŒ‡æ ‡ã€‚
  - å¯ä»¥ä½¿ç”¨ `ewm` å‡½æ•°è®¡ç®—æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡çº¿ã€‚
- `groupby` åŠŸèƒ½åœ¨å®é™…æ•°æ®åˆ†æä¸­æœ‰å“ªäº›åº”ç”¨ï¼Ÿ
  - å¯ä»¥æŒ‰ç±»åˆ«åˆ†ç»„ï¼Œè®¡ç®—æ¯ä¸ªç±»åˆ«çš„ç»Ÿè®¡é‡ã€‚
  - å¯ä»¥æŒ‰æ—¶é—´åˆ†ç»„ï¼Œè®¡ç®—æ¯ä¸ªæ—¶é—´æ®µçš„ç»Ÿè®¡é‡ã€‚
  - å¯ä»¥è‡ªå®šä¹‰åˆ†ç»„è§„åˆ™ï¼Œè¿›è¡Œæ›´çµæ´»çš„æ•°æ®åˆ†æã€‚
- ç»“åˆä¸€ä¸ªå…·ä½“æ¡ˆä¾‹ï¼Œå¦‚åˆ†ææŸä¸ªå•†åœºä¸åŒéƒ¨é—¨çš„é”€å”®æ•°æ®ï¼Œæ¥è®¾è®¡åˆ°åˆ°ç›®å‰è¯¾ä»¶ä¸ºæ­¢çš„pandasæ“ä½œï¼Ÿ
  -   1.  **æ•°æ®è¯»å–**ï¼š
      ```{python}
      import pandas as pd
      sales_data = pd.read_csv('å•†åœºé”€å”®æ•°æ®.csv')
      ```
      
  -   2.  **æ•°æ®æ¦‚è§ˆ**ï¼š
      ```{python}
      print(sales_data.head())  # æŸ¥çœ‹å‰å‡ è¡Œæ•°æ®
      print(sales_data.info())  # æŸ¥çœ‹æ•°æ®ç±»å‹å’Œç¼ºå¤±å€¼
      print(sales_data.describe())  # æŸ¥çœ‹æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯
      ```

  -   3.  **æ•°æ®æ¸…æ´—**ï¼š
      ```{python}
      # å¤„ç†ç¼ºå¤±å€¼ï¼ˆå‡è®¾ç”¨å¹³å‡å€¼å¡«å……ï¼‰
      sales_data.fillna(sales_data.mean(), inplace=True)
      # é‡å‘½ååˆ—å
      sales_data = sales_data.rename(columns={'éƒ¨é—¨': 'department', 'é”€å”®é¢': 'sales'})
      ```

  -   4.  **æ•°æ®è®¿é—®å’Œç­›é€‰**ï¼š
```{python}
      # è®¿é—®ç‰¹å®šåˆ—
      departments = sales_data['department']
      # è®¿é—®ç‰¹å®šè¡Œ
      first_row = sales_data.loc[0]
      # æ¡ä»¶ç­›é€‰ ç­›é€‰å‡ºé”€å”®é¢å¤§äº10000çš„è®°å½•
      high_sales = sales_data[sales_data['sales'] > 10000]
      # ä½¿ç”¨ loc ç­›é€‰å‡ºç‰¹å®šéƒ¨é—¨å’Œé”€å”®é¢çš„è®°å½•

clothing_sales = sales_data.loc[(sales_data['department'] == 'æœè£…') & (sales_data['sales'] > 5000)]
```

-   5.  **æ•°æ®ç»Ÿè®¡**ï¼š

```python
#| eval: false
# è®¡ç®—æ€»é”€å”®é¢
total_sales = sales_data['sales'].sum()

# è®¡ç®—æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡é”€å”®é¢
avg_sales_by_department = sales_data.groupby('department')['sales'].mean()

# è®¡ç®—æ¯ä¸ªéƒ¨é—¨çš„é”€å”®é¢æ ‡å‡†å·®
std_sales_by_department = sales_data.groupby('department')['sales'].std()
```

-   6.  **æ•°æ®æ’åº**ï¼š

```python
#| eval: false
# æŒ‰é”€å”®é¢é™åºæ’åˆ—
sales_data_sorted = sales_data.sort_values(by='sales', ascending=False)
```

-   7. **çª—å£å‡½æ•°åº”ç”¨ (å‡è®¾æœ‰æ—¥æœŸæ•°æ®)**ï¼š

```python
#| eval: false
# å‡è®¾æ•°æ®ä¸­æœ‰ 'date' åˆ—ï¼Œè¡¨ç¤ºé”€å”®æ—¥æœŸ
sales_data['date'] = pd.to_datetime(sales_data['date'])
sales_data.set_index('date', inplace=True)

# è®¡ç®— 7 å¤©æ»šåŠ¨å¹³å‡é”€å”®é¢
rolling_avg_sales = sales_data['sales'].rolling(window=7).mean()

# è®¡ç®—æ¯æœˆé”€å”®æ€»é¢
monthly_sales = sales_data['sales'].resample('M').sum()
```

-   8. **åˆ†ç»„èšåˆ**
```python
#| eval: false
# è®¡ç®—æ¯ä¸ªéƒ¨é—¨çš„é”€å”®æ€»é¢ã€å¹³å‡é”€å”®é¢ã€æœ€å¤§é”€å”®é¢
department_stats = sales_data.groupby('department')['sales'].agg(['sum', 'mean', 'max'])

# ç­›é€‰å‡ºé”€å”®æ€»é¢å¤§äº 50000 çš„éƒ¨é—¨
high_performing_departments = department_stats[department_stats['sum'] > 50000]
```

ä»¥ä¸Šæ˜¯ç”¨ Pandas è¿›è¡Œæ•°æ®åˆ†æçš„å¸¸è§æ“ä½œã€‚é€šè¿‡è¿™äº›æ“ä½œï¼Œå¯ä»¥ä»åŸå§‹æ•°æ®ä¸­æå–æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œä¸ºä¸šåŠ¡å†³ç­–æä¾›æ”¯æŒã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠè¿™éƒ¨åˆ†å†…å®¹æ•´åˆåˆ°å¹»ç¯ç‰‡æ–‡æ¡£ä¸­ï¼š

```qmd
---
title: "æ•°æ®åˆ†æç†è®ºä¸Pythonå®æˆ˜ ğŸ“Š"
subtitle: "ç¬¬äº”ç«  Pandasâ€”â€”å¤„ç†ç»“æ„åŒ–æ•°æ® ğŸ¼"
format:
  revealjs:
    theme: [sky]
    slide-number: true
    show-slide-number: all
    preview-links: auto
---

## ç›®å½•

- Pandasä»‹ç» ğŸ¼
- åŸºç¡€æ•°æ®ç»“æ„ ğŸ§±
- åŸºäºPandasçš„Indexå¯¹è±¡çš„è®¿é—®æ“ä½œ ğŸ”
- æ•°å­¦ç»Ÿè®¡å’Œè®¡ç®—å·¥å…· ğŸ§®
- æ•°å­¦èšåˆå’Œåˆ†ç»„è¿ç®— â•â–

## Pandasä»‹ç» ğŸ¼

::: {.callout-note}
Pandas æ˜¯ Python çš„ä¸€ä¸ª**å¼€æº**å·¥å…·åŒ…ï¼Œä¸º Python æä¾›äº†**é«˜æ€§èƒ½**ã€**ç®€å•æ˜“ç”¨**çš„æ•°æ®ç»“æ„å’Œæ•°æ®åˆ†æå·¥å…·ã€‚ å°±åƒä¸€ä¸ªè¶…çº§å·¥å…·ç®±ğŸ§°ï¼Œè®©æ•°æ®å¤„ç†å˜å¾—è½»æ¾åˆé«˜æ•ˆï¼
:::

- **ç±»è¡¨æ ¼ç»Ÿè®¡æ“ä½œ**ï¼šPandas æä¾›äº†æ–¹ä¾¿çš„ç±»ä¼¼äº Excel è¡¨æ ¼ ğŸ“Š çš„ç»Ÿè®¡æ“ä½œï¼Œå¯ä»¥è½»æ¾è¿›è¡Œæ±‚å’Œã€å¹³å‡ã€è®¡æ•°ç­‰ã€‚
- **ç±»SQLæ“ä½œ**ï¼šå¯ä»¥åƒæ“ä½œ SQL æ•°æ®åº“ ğŸ—„ï¸ ä¸€æ ·æ“ä½œæ•°æ®ï¼Œè¿›è¡Œæ•°æ®æŸ¥è¯¢ã€ç­›é€‰ã€è¿æ¥ç­‰ï¼Œéå¸¸é€‚åˆæ•°æ®é¢„å¤„ç†ã€‚
- **ç¼ºå¤±å€¼å¤„ç†**ï¼šPandas æä¾›äº†å¼ºå¤§çš„ç¼ºå¤±å€¼å¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥å¸®ä½ è½»æ¾æå®šæ•°æ®ä¸­çš„â€œæ´â€ğŸ•³ï¸ï¼Œä½¿æ•°æ®é¢„å¤„ç†æ›´ä¾¿æ·ã€‚

## Pandasä»‹ç» ğŸ¼

### Pandaså¯ä»¥å®Œæˆä»€ä¹ˆäº‹æƒ…ï¼Ÿ

- **ç´¢å¼•å¯¹è±¡**ï¼šåŒ…æ‹¬ç®€å•çš„ç´¢å¼•å’Œå¤šå±‚æ¬¡çš„ç´¢å¼•ï¼Œå°±åƒç»™æ•°æ®è´´ä¸Šæ ‡ç­¾ğŸ·ï¸ï¼Œæ–¹ä¾¿æŸ¥æ‰¾å’Œç®¡ç†ã€‚
- **å¼•æ“é›†æˆç»„åˆ**ï¼šç”¨äºæ±‡æ€»å’Œè½¬æ¢æ•°æ®é›†åˆï¼Œå¯ä»¥å°†å¤šä¸ªæ•°æ®æºæ•´åˆåœ¨ä¸€èµ·ï¼Œè¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚
- **æ—¥æœŸèŒƒå›´ç”Ÿæˆå™¨**ï¼šå¯ä»¥ç”Ÿæˆæ—¥æœŸèŒƒå›´ ğŸ“…ï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰æ—¥æœŸåç§»ï¼ˆå®ç°è‡ªå®šä¹‰é¢‘ç‡ï¼‰ï¼Œæ—¶é—´åºåˆ—åˆ†æå¿…å¤‡ï¼

```{python}
import pandas as pd

# ç”Ÿæˆæ—¥æœŸèŒƒå›´
date_range = pd.date_range(start='2023-01-01', end='2023-01-10')
print(date_range)

# è‡ªå®šä¹‰æ—¥æœŸåç§»
custom_dates = pd.date_range(start='2023-01-01', periods=5, freq='2D') # æ¯ä¸¤å¤©
print(custom_dates)
```

- **è¾“å…¥/è¾“å‡ºå·¥å…·**ï¼šä»å„ç§æ ¼å¼çš„æ–‡ä»¶ï¼ˆå¦‚ CSVã€Excelï¼‰ä¸­åŠ è½½è¡¨æ ¼æ•°æ®ï¼Œä»¥åŠä» PyTables/HDF5 æ ¼å¼ä¸­ä¿å­˜å’ŒåŠ è½½ Pandas å¯¹è±¡ã€‚æ•°æ®å¯¼å…¥å¯¼å‡ºï¼Œç•…é€šæ— é˜»ï¼
    -   **CSV (Comma Separated Values)**ï¼šé€—å·åˆ†éš”å€¼ï¼Œä¸€ç§å¸¸è§çš„æ–‡æœ¬æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå­˜å‚¨è¡¨æ ¼æ•°æ®ã€‚å¯ä»¥ç†è§£ä¸ºç”¨é€—å·`,`åˆ†éš”å­—æ®µï¼ˆåˆ—ï¼‰ï¼Œç”¨æ¢è¡Œç¬¦åˆ†éš”æ¯æ¡è®°å½•ï¼ˆè¡Œï¼‰çš„çº¯æ–‡æœ¬ã€‚
    -   **Delimited Files**: ä½¿ç”¨ç‰¹å®šåˆ†éš”ç¬¦ï¼ˆå¦‚åˆ¶è¡¨ç¬¦`\t`ã€ç©ºæ ¼` `ç­‰ï¼‰åˆ†éš”æ•°æ®çš„æ–‡ä»¶ã€‚
    -   **Excel 2003**: æŒ‡çš„æ˜¯ Microsoft Excel 2003 ç‰ˆæœ¬çš„æ–‡ä»¶æ ¼å¼ï¼ˆ.xlsï¼‰ã€‚ç°åœ¨æ›´å¸¸ç”¨çš„æ˜¯.xlsxæ ¼å¼ã€‚
    -   **PyTables/HDF5**: PyTables æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†åˆ†å±‚æ•°æ®é›†çš„ Python åŒ…ï¼Œè®¾è®¡ç”¨äºé«˜æ•ˆå¤„ç†å¤§é‡æ•°æ®ã€‚HDF5 (Hierarchical Data Format version 5) æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å’Œç®¡ç†æ•°æ®çš„æ–‡ä»¶æ ¼å¼ã€‚ç‰¹ç‚¹æ˜¯æ”¯æŒå­˜å‚¨éå¸¸å¤§çš„ã€å¼‚æ„çš„ã€å¤æ‚çš„æ•°æ®å¯¹è±¡ã€‚

```{python}
#| eval: false

# ä» CSV æ–‡ä»¶è¯»å–æ•°æ®
df = pd.read_csv('data.csv')

# å°†æ•°æ®ä¿å­˜ä¸º Excel æ–‡ä»¶
df.to_excel('data.xlsx', index=False)
```

- **æ ‡å‡†æ•°æ®ç»“æ„**ï¼šæ”¯æŒå­˜å‚¨å¤§é‡ç¼ºå¤±æˆ–ä¸€è‡´çš„æ•°æ®ï¼Œå°±åƒä¸€ä¸ªå¤§ä»“åº“ ğŸ­ï¼Œå¯ä»¥å®¹çº³å„ç§ç±»å‹çš„æ•°æ®ã€‚
- **ç§»åŠ¨çª—å£ç»Ÿè®¡**ï¼šå¦‚æ»šåŠ¨å¹³å‡å€¼ã€æ»šåŠ¨æ ‡å‡†åå·®ç­‰ï¼Œéå¸¸é€‚åˆå¤„ç†æ—¶é—´åºåˆ—æ•°æ®ï¼Œå°±åƒä¸€ä¸ªæ»‘åŠ¨çª—å£ ğŸªŸï¼Œå¯ä»¥è§‚å¯Ÿæ•°æ®çš„å˜åŒ–è¶‹åŠ¿ã€‚

## åŸºç¡€æ•°æ®ç»“æ„â€”â€”Series ğŸ§±

::: {.callout-tip}
**Series** æ˜¯ Pandas ä¸­ä¸€ç§é‡è¦çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äº**ä¸€ç»´æ•°ç»„**ä¸**å­—å…¸**çš„ç»“åˆã€‚å¯ä»¥çœ‹ä½œæ˜¯å¸¦æ ‡ç­¾çš„æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ ‡ç­¾ï¼ˆç´¢å¼•ï¼‰ã€‚
:::

- **å®šé•¿æœ‰åºå­—å…¸**ï¼šSeries å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®šé•¿ã€æœ‰åºçš„â€œå­—å…¸â€ç»“æ„ï¼Œé”®å€¼å¯¹ä¸€ä¸€å¯¹åº”ã€‚
- **æœ‰æ ‡ç­¾çš„ä¸€ç»´æ•°ç»„**ï¼šSeries æ˜¯ä¸€ä¸ªæœ‰æ ‡ç­¾çš„ä¸€ç»´æ•°ç»„ï¼Œæ ‡ç­¾åœ¨ Pandas ä¸­å¯¹åº”çš„æ•°æ®ç±»å‹æ˜¯ `index`ã€‚

### Seriesçš„åˆ›å»º

- é€šè¿‡ `list` åˆ›å»ºï¼š

```{python}
import pandas as pd

data = [1, 2, 3, 4, 5]  # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨
series_from_list = pd.Series(data)  # ç”¨åˆ—è¡¨åˆ›å»º Series
print(series_from_list) # æ‰“å° Series, åŒ…å«ç´¢å¼•å’Œå€¼
```

::: {.callout-note}
åˆ›å»ºSeriesæ—¶å¯ä»¥æŒ‡å®šindexï¼Œå¦‚æœæ²¡æŒ‡å®šindexï¼Œåˆ™è‡ªåŠ¨ä½¿ç”¨æ•´æ•°ç´¢å¼•ï¼Œä»0å¼€å§‹ã€‚
:::

- é€šè¿‡ `NumPy` çš„ `ndarray` åˆ›å»ºï¼š

```{python}
import pandas as pd
import numpy as np

data = np.array([1, 2, 3, 4, 5]) # åˆ›å»ºä¸€ä¸ª NumPy æ•°ç»„
series_from_ndarray = pd.Series(data)  # ç”¨ NumPy æ•°ç»„åˆ›å»º Series
print(series_from_ndarray)
```

- é€šè¿‡ `dict` åˆ›å»ºï¼š

```{python}
import pandas as pd

data = {'a': 1, 'b': 2, 'c': 3} # åˆ›å»ºä¸€ä¸ªå­—å…¸
series_from_dict = pd.Series(data)  # ç”¨å­—å…¸åˆ›å»º Series
print(series_from_dict)  # å­—å…¸çš„é”®ä¼šæˆä¸º Series çš„ç´¢å¼•
```

- é€šè¿‡æ ‡é‡åˆ›å»ºï¼š

```{python}
import pandas as pd

series_from_scalar = pd.Series(5, index=['a', 'b', 'c'])  # åˆ›å»ºä¸€ä¸ªæ‰€æœ‰å€¼éƒ½ä¸º 5 çš„ Series
print(series_from_scalar)
```

## Seriesçš„è®¿é—®å’Œæ“ä½œ

### Seriesçš„è®¿é—®

- ä½¿ç”¨ `iloc` å’Œ `loc` å‡½æ•°ï¼š
  - `iloc`ï¼šé€šè¿‡**ä½ç½®**è®¿é—®ï¼Œå°±åƒæ•°ç»„ä¸€æ ·ï¼Œä½¿ç”¨æ•´æ•°ç´¢å¼•ã€‚
  - `loc`ï¼šé€šè¿‡**æ ‡ç­¾**è®¿é—®ï¼Œå°±åƒå­—å…¸ä¸€æ ·ï¼Œä½¿ç”¨ç´¢å¼•å€¼ã€‚

```{python}
import pandas as pd

s = pd.Series([10, 20, 30], index=['a', 'b', 'c'])

# é€šè¿‡ä½ç½®è®¿é—®
print(s.iloc[0])  # è¾“å‡º: 10

# é€šè¿‡æ ‡ç­¾è®¿é—®
print(s.loc['b']) # è¾“å‡º: 20
```

- ç±»ä¼¼æ•°ç»„å’Œå±æ€§çš„è®¿é—®ï¼š

```{python}
# ç±»ä¼¼æ•°ç»„
print(s[0])  # è¾“å‡º: 10

# ç±»ä¼¼å±æ€§(å¦‚æœç´¢å¼•æ˜¯æœ‰æ•ˆçš„Pythonå˜é‡å)
print(s.a) # è¾“å‡º: 10
```

### Seriesçš„æ“ä½œ

- **å‘é‡åŒ–æ“ä½œ**ï¼šåƒæ•°ç»„ä¸€æ ·å¯¹ Series è¿›è¡Œæ“ä½œï¼Œæ— éœ€å¾ªç¯ï¼ŒPandas ä¼šè‡ªåŠ¨å¤„ç†ã€‚
- **NumPyå…¼å®¹æ€§**ï¼šNumPy ä¸­å¯¹ `ndarray` çš„æ“ä½œä¹Ÿé€‚ç”¨äº Seriesï¼Œä¾‹å¦‚åŠ å‡ä¹˜é™¤ã€æ±‚å’Œã€å¹³å‡ç­‰ã€‚
- **æ•°æ®å¯¹é½**ï¼šç”±äºç´¢å¼•çš„å­˜åœ¨ï¼ŒSeries åœ¨æ“ä½œæ—¶ä¼šè‡ªåŠ¨å¯¹é½æ•°æ®ï¼Œä¸åŒç´¢å¼•çš„æ•°æ®ä¼šè¿›è¡ŒåŒ¹é…ï¼Œæ‰¾ä¸åˆ°åŒ¹é…çš„ä¼šç”¨ `NaN` å¡«å……ã€‚

```{python}
import pandas as pd

s1 = pd.Series([1, 2, 3], index=['a', 'b', 'c'])
s2 = pd.Series([4, 5, 6], index=['b', 'c', 'd'])

print(s1 + s2)  # ç´¢å¼•å¯¹é½ï¼Œ'a' å’Œ 'd' å¯¹åº”çš„å€¼ä¸º NaN
```

## åŸºç¡€æ•°æ®ç»“æ„â€”â€”DataFrame ğŸ§±

::: {.callout-note}
**DataFrame** æ˜¯ Pandas ä¸­æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œæ˜¯æœ‰æ ‡ç­¾çš„**äºŒç»´æ•°ç»„**ï¼Œç±»ä¼¼äº**è¡¨æ ¼** ğŸ“‡ã€**SQL**ä¸­çš„ `table`ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª `Series` å¯¹è±¡çš„ `dict`ã€‚ å¯ä»¥çœ‹ä½œæ˜¯å¤šä¸ª Series å…±äº«åŒä¸€ä¸ªç´¢å¼•ã€‚
:::

- **è¡Œç´¢å¼• (index)** å’Œ **åˆ—ç´¢å¼• (columns)**ï¼šDataFrame åŒæ—¶å…·æœ‰è¡Œç´¢å¼•å’Œåˆ—ç´¢å¼•ï¼Œå°±åƒä¸€ä¸ªè¡¨æ ¼æœ‰è¡Œæ ‡é¢˜å’Œåˆ—æ ‡é¢˜ã€‚

### DataFrameçš„åˆ›å»º

- **è¾“å…¥**ï¼š
  - ä¸€ç»´ `ndarray`ã€`list`ã€`dict` æˆ– `Series` çš„ `dict`ã€‚
  - äºŒç»´ `ndarray`ã€‚
  - ä¸€ä¸ª `Series`ã€‚
  - å…¶ä»– `DataFrame`ã€‚

```{python}
import pandas as pd

# ç”¨å­—å…¸åˆ›å»º DataFrame
data = {'col1': [1, 2], 'col2': [3, 4]}
df = pd.DataFrame(data)
print(df)

# ç”¨äºŒç»´æ•°ç»„åˆ›å»º DataFrame
data = [[1, 2], [3, 4]]
df = pd.DataFrame(data, columns=['col1', 'col2'])
print(df)
```

- **ç´¢å¼•**ï¼š
  - åˆ›å»º DataFrame æ—¶ï¼Œå¯ä»¥é€šè¿‡ `index` å’Œ `columns` å‚æ•°æŒ‡å®šè¡Œç´¢å¼•å’Œåˆ—ç´¢å¼•ã€‚
  - å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä» 0 å¼€å§‹çš„æ•´æ•°ç´¢å¼•ã€‚

- **Seriesçš„dictåˆ›å»ºDataFrame**ï¼š
  - è‹¥æŒ‡å®š `index`ï¼Œä¼šä¸¢å¼ƒæ‰€æœ‰æœªå’ŒæŒ‡å®š `index` åŒ¹é…çš„æ•°æ®ã€‚

```{python}
import pandas as pd

data = {'col1': pd.Series([1, 2, 3], index=['a', 'b', 'c']),
        'col2': pd.Series([1, 2, 3, 4], index=['a', 'b', 'c', 'd'])}
df = pd.DataFrame(data)  # å­—å…¸çš„é”®ä¼šæˆä¸º DataFrame çš„åˆ—å
print(df) # indexè‡ªåŠ¨å–å¹¶é›†

df = pd.DataFrame(data, index=['a','b'])
print(df) # indexå‚æ•°ä¸º['a','b']ï¼Œdfåªæœ‰'a','b'ä¸¤è¡Œï¼ŒæŠ›å¼ƒäº†'c'å’Œ'd'è¡Œçš„æ•°æ®
```

::: {.callout-note}
ç”¨Seriesçš„å­—å…¸åˆ›å»ºDataFrameæ—¶ï¼Œindexå¦‚æœä¸æŒ‡å®šï¼Œä¼šè‡ªåŠ¨å–å¹¶é›†ã€‚
:::

## DataFrameçš„è®¿é—®å’Œæ“ä½œ

### DataFrameçš„è®¿é—®

- å¤šç§è®¿é—®æ–¹å¼:
  - é€šè¿‡**åˆ—ç´¢å¼•**è®¿é—®ï¼š
  ```{python}
    #| eval: false
    df['column_label']
  ```
  - é€šè¿‡**è¡Œç´¢å¼•**è®¿é—®ï¼š
  ```{python}
    #| eval: false
    df.loc['row_label']
  ```
  - `loc`: é€šè¿‡**è¡Œæ ‡ç­¾**è®¿é—®
    ```{python}
    #| eval: false
    print(df.loc['row_label'])
    ```
  - `iloc`ï¼šé€šè¿‡**è¡Œä½ç½®**è®¿é—®ã€‚
     ```{python}
     #| eval: false
     print(df.iloc[row_position])
     ```

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data, index=['A', 'B', 'C'])

# é€šè¿‡åˆ—ç´¢å¼•è®¿é—®
print(df['col1'])  # é€‰æ‹© 'col1' åˆ—

# é€šè¿‡ loc è®¿é—®
print(df.loc['A'])  # é€‰æ‹© 'A' è¡Œ

# é€šè¿‡ iloc è®¿é—®
print(df.iloc[0])  # é€‰æ‹©ç¬¬ä¸€è¡Œ
```

### DataFrameçš„æ“ä½œ

- **ç®—æœ¯æ“ä½œ**ï¼šæ”¯æŒåŠ ã€å‡ã€ä¹˜ã€é™¤ã€è½¬ç½®ç­‰ï¼Œå°±åƒæ“ä½œçŸ©é˜µä¸€æ ·ã€‚
- **NumPyå…¼å®¹æ€§**ï¼šNumPy ä¸­å¯¹çŸ©é˜µçš„æ“ä½œä¹Ÿé€‚ç”¨äº DataFrameã€‚
- **æ•°æ®å¯¹é½**ï¼šDataFrame åœ¨æ“ä½œæ—¶ä¼šè‡ªåŠ¨æŒ‰è¡Œå’Œåˆ—ç´¢å¼•å¯¹é½æ•°æ®ï¼Œä¸åŒç´¢å¼•çš„æ•°æ®ä¼šè¿›è¡ŒåŒ¹é…ï¼Œæ‰¾ä¸åˆ°åŒ¹é…çš„ä¼šç”¨ `NaN` å¡«å……ã€‚
- **å¢åˆ æ”¹æŸ¥**ï¼šå¯ä»¥å¯¹ DataFrame è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œã€‚

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data)

# æ·»åŠ ä¸€åˆ—
df['col3'] = [7, 8, 9]

# åˆ é™¤ä¸€åˆ—
df = df.drop('col2', axis=1)

# ä¿®æ”¹æ•°æ®
df.loc[0, 'col1'] = 10

# æŸ¥è¯¢æ•°æ®
print(df[df['col1'] > 1])
print(df)
```

## åŸºäºPandasçš„Indexå¯¹è±¡çš„è®¿é—®æ“ä½œ ğŸ”

### Pandasçš„Indexå¯¹è±¡

- `Series` ä¸­çš„ `index` å±æ€§ã€‚
- `DataFrame` ä¸­çš„ `index` å±æ€§å’Œ `columns` å±æ€§ã€‚

::: {.callout-note}
`Series` å’Œ `DataFrame` çš„ç´¢å¼•éƒ½æ˜¯ `Index` å¯¹è±¡ï¼Œç”¨äºæ ‡è¯†å’Œè®¿é—®æ•°æ®ã€‚
:::

### Indexå¯¹è±¡çš„ç‰¹å¾

- **ä¸å¯ä¿®æ”¹** (Immutable)ï¼šIndex å¯¹è±¡ä¸€æ—¦åˆ›å»ºï¼Œå°±ä¸èƒ½ä¿®æ”¹ï¼Œä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚
- **æœ‰åº**ï¼šIndex å¯¹è±¡ä¸­çš„å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥æŒ‰ç…§é¡ºåºè®¿é—®ã€‚
- **å¯åˆ‡ç‰‡**ï¼šå¯ä»¥åƒåˆ—è¡¨æˆ–æ•°ç»„ä¸€æ ·å¯¹ Index å¯¹è±¡è¿›è¡Œåˆ‡ç‰‡æ“ä½œï¼Œæ–¹ä¾¿è·å–éƒ¨åˆ†æ•°æ®ã€‚

### Indexå¯¹è±¡çš„ç±»å‹

- **Index**ï¼šæœ€æ³›åŒ–çš„ Index ç±»å‹ï¼Œå°†è½´æ ‡ç­¾è¡¨ç¤ºä¸ºä¸€ä¸ªç”± Python å¯¹è±¡ç»„æˆçš„ NumPy æ•°ç»„ã€‚
- **Int64Index**ï¼šé’ˆå¯¹æ•´æ•°çš„ Index ç±»å‹ï¼Œç”¨äºæ•´æ•°ç´¢å¼•ã€‚
- **MultiIndex**ï¼šé’ˆå¯¹å¤šå±‚ç´¢å¼•çš„ Index ç±»å‹ï¼Œç”¨äºåˆ›å»ºå¤æ‚çš„å±‚æ¬¡åŒ–ç´¢å¼•ã€‚
- **DatetimeIndex**ï¼šå­˜å‚¨æ—¶é—´æˆ³çš„ Index ç±»å‹ï¼Œç”¨äºæ—¶é—´åºåˆ—æ•°æ®ã€‚
- **PeriodIndex**ï¼šé’ˆå¯¹æ—¶é—´é—´éš”æ•°æ®çš„ Index ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºä¸€æ®µæ—¶é—´ã€‚

## Indexå¯¹è±¡çš„åŸºæœ¬æ“ä½œ ğŸ§®

| å‡½æ•°           | è¯´æ˜                                                                  |
| -------------- | --------------------------------------------------------------------- |
| `delete`       | åˆ é™¤ç´¢å¼• `i` å¤„çš„å…ƒç´ ï¼Œè¿”å›æ–°çš„ Index å¯¹è±¡ï¼ˆå¯ä»¥ä¼ å…¥ç´¢å¼•çš„æ•°ç»„ï¼‰          |
| `drop`         | åˆ é™¤ä¼ å…¥çš„å…ƒç´  `e`ï¼Œè¿”å›æ–°çš„ Index å¯¹è±¡ï¼ˆå¯ä»¥ä¼ å…¥å…ƒç´ çš„æ•°ç»„ï¼‰            |
| `insert`       | å°†å…ƒç´ æ’å…¥ç´¢å¼• `i` å¤„ï¼Œè¿”å›æ–°çš„ Index å¯¹è±¡                             |
| `append`       | è¿æ¥å¦ä¸€ä¸ª Index å¯¹è±¡ï¼Œè¿”å›æ–°çš„ Index å¯¹è±¡                               |
| `union`        | ä¸å¦ä¸€ä¸ª Index å¯¹è±¡è¿›è¡Œå¹¶æ“ä½œï¼Œè¿”å›ä¸¤è€…çš„å¹¶é›†                             |
| `difference`   | ä¸å¦ä¸€ä¸ª Index å¯¹è±¡è¿›è¡Œå·®æ“ä½œï¼Œè¿”å›ä¸¤è€…çš„å·®é›†                             |
| `intersection` | ä¸å¦ä¸€ä¸ª Index å¯¹è±¡è¿›è¡Œäº¤æ“ä½œï¼Œè¿”å›ä¸¤è€…çš„äº¤é›†                             |
| `isin`         | åˆ¤æ–­ Index å¯¹è±¡ä¸­æ¯ä¸ªå…ƒç´ æ˜¯å¦åœ¨å‚æ•°æ‰€ç»™çš„æ•°ç»„ç±»å‹å¯¹è±¡ä¸­ï¼Œè¿”å›ä¸€ä¸ªä¸ Index å¯¹è±¡é•¿åº¦ç›¸åŒçš„ Bool æ•°ç»„ |
| `is_monotonic` | å½“æ¯ä¸ªå…ƒç´ éƒ½å¤§äºå‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¿”å› `True`                                |
| `is_unique`    | å½“ Index å¯¹è±¡ä¸­æ²¡æœ‰é‡å¤å€¼æ—¶ï¼Œè¿”å› `True`                                  |
| `unique`       | è¿”å›æ²¡æœ‰é‡å¤æ•°æ®çš„ Index å¯¹è±¡                                             |

```{python}
#| eval: false

import pandas as pd

index = pd.Index(['a', 'b', 'c', 'd'])

# åˆ é™¤ç´¢å¼•ä¸º 1 çš„å…ƒç´ 
new_index = index.delete(1)  # new_index: Index(['a', 'c', 'd'], dtype='object')

# åˆ é™¤å…ƒç´  'c'
new_index = index.drop('c')  # new_index: Index(['a', 'b', 'd'], dtype='object')

# æ’å…¥å…ƒç´  'e' åˆ°ç´¢å¼• 2
new_index = index.insert(2, 'e')  # new_index: Index(['a', 'b', 'e', 'c', 'd'], dtype='object')

# è¿æ¥å¦ä¸€ä¸ª Index å¯¹è±¡
other_index = pd.Index(['e', 'f'])
new_index = index.append(other_index)  # new_index: Index(['a', 'b', 'c', 'd', 'e', 'f'], dtype='object')
```

## ç´¢å¼•çš„ä¸åŒè®¿é—®æ–¹å¼

### loc æ–¹å¼

- å…³æ³¨ `index` çš„ **label**ï¼Œç­›é€‰æ¡ä»¶ä¸ `label` ç›¸å…³ã€‚
- æ¥æ”¶ `index` çš„ `label` ä½œä¸ºå‚æ•°è¾“å…¥ã€‚
- å¯ä»¥æ¥æ”¶ï¼š
  - å•ä¸ª `label`ã€‚
  - `label` çš„æ•°ç»„ã€‚
  - `label` çš„åˆ†ç‰‡ (`slice`)ã€‚
  - å¸ƒå°”æ•°ç»„ã€‚
  - å›è°ƒå‡½æ•°ï¼ˆå‚æ•°ä¸ºè°ƒç”¨ `loc` å‡½æ•°çš„å¯¹è±¡ï¼Œå³ `Series` æˆ– `DataFrame`ï¼‰ã€‚

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data, index=['A', 'B', 'C'])

# å•ä¸ª label
print(df.loc['A'])

# label æ•°ç»„
print(df.loc[['A', 'C']])

# label åˆ†ç‰‡
print(df.loc['A':'B'])

# å¸ƒå°”æ•°ç»„
print(df.loc[df['col1'] > 1])

# å›è°ƒå‡½æ•°
print(df.loc[lambda df: df['col2'] > 4])
```

### iloc æ–¹å¼

- å…³æ³¨ `index` çš„ **position**ã€‚
- æ¥æ”¶ `index` çš„ `position` ä½œä¸ºå‚æ•°è¾“å…¥ã€‚
- å¯ä»¥æ¥æ”¶ï¼š
  - å•ä¸ªæ•´æ•°ï¼ˆè¡¨ç¤º `position`ï¼‰ã€‚
  - `position` çš„æ•°ç»„ã€‚
  - `position` çš„åˆ†ç‰‡ (`slice`)ã€‚
  - å¸ƒå°”æ•°ç»„ã€‚
  - å›è°ƒå‡½æ•°ï¼ˆå‚æ•°ä¸ºè°ƒç”¨ `iloc` å‡½æ•°çš„å¯¹è±¡ï¼Œå³ `Series` æˆ– `DataFrame`ï¼‰ã€‚

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data, index=['A', 'B', 'C'])

# å•ä¸ªæ•´æ•°
print(df.iloc[0])

# position æ•°ç»„
print(df.iloc[[0, 2]])

# position åˆ†ç‰‡
print(df.iloc[0:2])

# å¸ƒå°”æ•°ç»„
print(df.iloc[(df['col1'] > 1).values])

# å›è°ƒå‡½æ•°
print(df.iloc[lambda df: [0, 2]])  # æ³¨æ„ï¼šè¿™é‡Œçš„å›è°ƒå‡½æ•°è¿”å›çš„æ˜¯ä½ç½®åˆ—è¡¨
```

### ç±»ä¼¼dictæ–¹å¼çš„è®¿é—®

- å¯ä»¥å°† `Series` å’Œ `DataFrame` çœ‹ä½œ `dict`ã€‚
- `DataFrame` ç›¸å½“äºæ¯ä¸ªå…ƒç´ æ˜¯ `Series` çš„ `dict`ã€‚
- å¯ä»¥ç”¨ç±»ä¼¼ `dict` è®¿é—®çš„æ–¹å¼æ¥è®¿é—® `Series` å’Œ `DataFrame`ã€‚

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data)

# è®¿é—® 'col1' åˆ—
print(df['col1'])  # ç±»ä¼¼äºè®¿é—®å­—å…¸çš„é”®

# å¯¹äº Seriesï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç´¢å¼•è®¿é—®
s = pd.Series([10, 20, 30], index=['a', 'b', 'c'])
print(s['b'])
```

### ç±»ä¼¼å±æ€§æ–¹å¼çš„è®¿é—®

- æ¥å—å‚æ•°ç±»å‹åŒ…æ‹¬ï¼š
  - å•ä¸ªå˜é‡
  - æ•°ç»„å½¢å¼ï¼ˆ`list` æˆ–è€… `NumPy` çš„ `ndarray`ï¼‰
  - å¸ƒå°”æ•°ç»„
  - å›è°ƒå‡½æ•°ã€‚

```{python}
import pandas as pd

data = {'col1': [1, 2, 3], 'col2': [4, 5, 6]}
df = pd.DataFrame(data, index=['A', 'B', 'C'])

# å•ä¸ªå˜é‡
print(df.col1)  # è®¿é—® 'col1' åˆ—ï¼Œç±»ä¼¼äºè®¿é—®å¯¹è±¡çš„å±æ€§

# æ•°ç»„å½¢å¼
print(df[['col1', 'col2']])

# å¸ƒå°”æ•°ç»„
print(df[df.col1 > 1])  # ä½¿ç”¨å¸ƒå°”æ•°ç»„ç­›é€‰æ•°æ®

# å›è°ƒå‡½æ•°
print(df[lambda df: df.col2 > 4])
```

## è°ƒç”¨æ–¹å¼é—´çš„åŒºåˆ«

### locå‡½æ•°å’Œilocå‡½æ•°çš„åŒºåˆ«

- `loc` å‡½æ•°å’Œ `iloc` å‡½æ•°éƒ½æ˜¯å¯¹ `index` çš„è®¿é—®ã€‚
- å¯¹äº `DataFrame`ï¼Œä¹Ÿå¯ä»¥å®ç°å¯¹æŸä¸ª `index` ä¸‹çš„æŸä¸ª `column` çš„è®¿é—®ã€‚
- æ¥æ”¶çš„æ•°æ®ç±»å‹ç›¸åŒï¼Œä½†å«ä¹‰ä¸åŒï¼š
  - `loc` å‡½æ•°æ¥æ”¶ `Index` å¯¹è±¡ï¼ˆ`index` å’Œ `columns`ï¼‰çš„ `label`ã€‚
  - `iloc` å‡½æ•°æ¥æ”¶ `Index` å¯¹è±¡ï¼ˆ`index` å’Œ `columns`ï¼‰çš„ `position`ã€‚

### é€šè¿‡locè®¿é—®å’Œé€šè¿‡[]è®¿é—®çš„åŒºåˆ«

- `loc` å‡½æ•°å’Œ `[]` éƒ½æ¥æ”¶ `Index` å¯¹è±¡ï¼ˆ`index` å’Œ `columns`ï¼‰çš„ `label` ä½œä¸ºå‚æ•°ã€‚
- `loc` å‡½æ•°æ˜¯å¯¹ `index` çš„è®¿é—®ã€‚
- `[]` åœ¨ `DataFrame` ä¸­æ˜¯å¯¹ `columns` çš„è®¿é—®ï¼Œåœ¨ `Series` ä¸­æ— å·®åˆ«ã€‚

## ç‰¹æ®Šçš„è¾“å…¥ç±»å‹

### è¾“å…¥ä¸ºå¸ƒå°”ç±»å‹æ•°ç»„

- ä½¿ç”¨å¸ƒå°”ç±»å‹æ•°ç»„ä½œä¸ºè¾“å…¥å‚æ•°ä¹Ÿæ˜¯å¸¸è§çš„æ“ä½œä¹‹ä¸€ã€‚
- å¯ç”¨çš„è¿ç®—ç¬¦åŒ…æ‹¬ï¼š
  - `|` (æˆ–è¿ç®—)
  - `&` (ä¸è¿ç®—)
  - `~` (éè¿ç®—)
- **æ³¨æ„**ï¼šè¦ä½¿ç”¨åœ†æ‹¬å· `()` æ¥ç»„åˆæ¡ä»¶ã€‚

```{python}
import pandas as pd

df = pd.DataFrame({'col1': [1, 2, 3], 'col2': [4, 5, 6]})

# é€‰å– col1 å¤§äº 1 ä¸” col2 å°äº 6 çš„è¡Œ
print(df[(df['col1'] > 1) & (df['col2'] < 6)])

# é€‰å– col1 ç­‰äº 1 æˆ– col2 å¤§äº 5 çš„è¡Œ
print(df[(df['col1'] == 1) | (df['col2'] > 5)])
```

### è¾“å…¥ä¸ºå›è°ƒå‡½æ•°

- `loc`ã€`iloc` å’Œ `[]` éƒ½æ¥æ”¶å›è°ƒå‡½æ•°ä½œä¸ºè¾“å…¥æ¥è¿›è¡Œè®¿é—®ã€‚
- å›è°ƒå‡½æ•°å¿…é¡»ä»¥è¢«è®¿é—®çš„ `Series` æˆ–è€… `DataFrame` ä½œä¸ºå‚æ•°ã€‚

```{python}
import pandas as pd

df = pd.DataFrame({'col1': [1, 2, 3], 'col2': [4, 5, 6]})

# ä½¿ç”¨å›è°ƒå‡½æ•°é€‰å– col2 å¤§äº 4 çš„è¡Œ
print(df[lambda df: df['col2'] > 4])

# ä½¿ç”¨ loc å’Œå›è°ƒå‡½æ•°é€‰å– col1 å¤§äº 1 çš„è¡Œ
print(df.loc[lambda df: df['col1'] > 1])

# ä½¿ç”¨ iloc å’Œå›è°ƒå‡½æ•°é€‰å–ç¬¬ 0 è¡Œå’Œç¬¬ 2 è¡Œ
print(df.iloc[lambda df: [0, 2]])
```

## æ•°å­¦ç»Ÿè®¡å’Œè®¡ç®—å·¥å…· ğŸ§®

### ç»Ÿè®¡å‡½æ•°

- Pandas æä¾›äº†ä¸€ç³»åˆ—ç»Ÿè®¡å‡½æ•°æ¥å£ï¼Œæ–¹ä¾¿ç”¨æˆ·ç›´æ¥è¿›è¡Œç»Ÿè®¡è¿ç®—ã€‚
- åŒ…æ‹¬ï¼š
  - **åæ–¹å·®:** ç”¨äºè¡¡é‡ä¸¤ä¸ªå˜é‡çš„æ€»ä½“è¯¯å·®ã€‚å½“ä¸¤ä¸ªå˜é‡çš„å˜åŒ–è¶‹åŠ¿ä¸€è‡´æ—¶ï¼Œåæ–¹å·®ä¸ºæ­£ï¼›å½“å˜åŒ–è¶‹åŠ¿ç›¸åæ—¶ï¼Œåæ–¹å·®ä¸ºè´Ÿï¼›å¦‚æœä¸¤ä¸ªå˜é‡ç›¸äº’ç‹¬ç«‹ï¼Œåˆ™åæ–¹å·®ä¸º0ã€‚
  - **ç›¸å…³ç³»æ•°:** ç”¨äºç ”ç©¶å˜é‡ä¹‹é—´çº¿æ€§ç›¸å…³ç¨‹åº¦çš„é‡ã€‚ç›¸å…³ç³»æ•°çš„å–å€¼èŒƒå›´åœ¨-1åˆ°1ä¹‹é—´ï¼Œç»å¯¹å€¼è¶Šå¤§ï¼Œè¯´æ˜å˜é‡ä¹‹é—´çš„çº¿æ€§ç›¸å…³æ€§è¶Šå¼ºã€‚
  - **æ’åº:** å¯¹æ•°æ®è¿›è¡Œæ’åºã€‚

- Pandas æä¾›äº†ï¼š
  - ä¸¤ä¸ª `Series` å¯¹è±¡ä¹‹é—´çš„åæ–¹å·®è®¡ç®—æ¥å£ã€‚
  - ä¸€ä¸ª `DataFrame` çš„åæ–¹å·®çŸ©é˜µçš„è®¡ç®—æ¥å£ã€‚

```{python}
import pandas as pd

s1 = pd.Series([1, 2, 3, 4, 5])
s2 = pd.Series([2, 3, 1, 5, 4])

# è®¡ç®— s1 å’Œ s2 çš„åæ–¹å·®
covariance = s1.cov(s2)
print(f"åæ–¹å·®: {covariance}")

# è®¡ç®— s1 å’Œ s2 çš„ç›¸å…³ç³»æ•°
correlation = s1.corr(s2)
print(f"ç›¸å…³ç³»æ•°: {correlation}")

df = pd.DataFrame({'col1': [1, 2, 3], 'col2': [4, 5, 6]})

# è®¡ç®— DataFrame çš„åæ–¹å·®çŸ©é˜µ
cov_matrix = df.cov()
print(f"åæ–¹å·®çŸ©é˜µ:\n{cov_matrix}")

# è®¡ç®— DataFrame çš„ç›¸å…³ç³»æ•°çŸ©é˜µ
corr_matrix = df.corr()
print(f"ç›¸å…³ç³»æ•°çŸ©é˜µ:\n{corr_matrix}")
```

## çª—å£å‡½æ•°

::: {.callout-tip}
åœ¨ç§»åŠ¨çª—å£ä¸Šè®¡ç®—ç»Ÿè®¡å‡½æ•°å¯¹äºå¤„ç†**æ—¶åºæ•°æ®** ğŸ“ˆ éå¸¸å¸¸è§ã€‚
:::

- Pandas æä¾›äº†ä¸€ç³»åˆ—çª—å£å‡½æ•°ï¼ŒåŒ…æ‹¬ï¼š
  - è®¡æ•°
  - æ±‚å’Œ
  - æ±‚å¹³å‡
  - ä¸­ä½æ•°
  - ç›¸å…³ç³»æ•°
  - æ–¹å·®
  - åæ–¹å·®
  - æ ‡å‡†å·®
  - åæ–œåº¦
  - å³°åº¦
- çª—å£å¯¹è±¡ï¼š
  - **Rolling**:
    - å®šé•¿çš„çª—å£ã€‚
    - éœ€è¦é€šè¿‡å‚æ•° `window` æŒ‡å®šçª—å£å¤§å°ã€‚
  - **Expanding**:
    - æ‰©å±•çª—å£ã€‚
    - ç¬¬ `i` ä¸ªçª—å£çš„å¤§å°ä¸º `i`ã€‚
    - å¯ä»¥å°†å…¶çœ‹ä½œç‰¹æ®Šçš„ `windows` ä¸ºæ•°æ®é•¿åº¦ã€`min_periods` ä¸º 1 çš„ `Rolling` å¯¹è±¡ã€‚
  - **EWM (Exponentially Weighted Moving)**:
    - æŒ‡æ•°åŠ æƒçª—å£ã€‚
    - éœ€è¦å®šä¹‰è¡°å‡å› å­ Î±ã€‚
    - å®šä¹‰æ–¹å¼ï¼š
      - æ—¶é—´é—´éš” `span`ã€‚
      - è´¨å¿ƒ `center of mass`ã€‚
      - åŠè¡°æœŸ `half-life`ï¼ˆæŒ‡æ•°æƒé‡å‡å°‘åˆ°ä¸€åŠéœ€è¦çš„æ—¶é—´ï¼‰ã€‚
      - ç›´æ¥å®šä¹‰ `alpha`ã€‚

```{python}
import pandas as pd

# åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—
s = pd.Series([1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
              index=pd.date_range('2023-01-01', periods=10, freq='D'))

# Rolling çª—å£
rolling_mean = s.rolling(window=3).mean()  # è®¡ç®— 3 å¤©çš„æ»šåŠ¨å¹³å‡å€¼
print(f"æ»šåŠ¨å¹³å‡:\n{rolling_mean}")

# Expanding çª—å£
expanding_sum = s.expanding().sum()  # è®¡ç®—ç´¯è®¡å’Œ
print(f"ç´¯è®¡å’Œ:\n{expanding_sum}")

# EWM çª—å£
ewm_mean = s.ewm(span=3).mean()  # è®¡ç®—æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡å€¼
print(f"æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡:\n{ewm_mean}")
```

## çª—å£å¯¹è±¡çš„ç»Ÿè®¡å‡½æ•° ğŸ“Š

| å‡½æ•°         | è¯´æ˜                                                                 |
| ------------ | -------------------------------------------------------------------- |
| `count()`    | ç§»åŠ¨çª—å£å†…é `NaN` å€¼çš„è®¡æ•°                                              |
| `sum()`      | ç§»åŠ¨çª—å£å†…çš„å’Œ                                                         |
| `mean()`     | ç§»åŠ¨çª—å£å†…çš„å¹³å‡å€¼                                                     |
| `median()`   | ç§»åŠ¨çª—å£å†…çš„ä¸­ä½æ•°                                                     |
| `min()`      | ç§»åŠ¨çª—å£å†…çš„æœ€å°å€¼                                                     |
| `max()`      | ç§»åŠ¨çª—å£å†…çš„æœ€å¤§å€¼                                                     |
| `std()`      | ç§»åŠ¨çª—å£å†…çš„æ— åä¼°è®¡æ ‡å‡†å·®ï¼ˆåˆ†æ¯ä¸º `n-1`ï¼‰                                |
| `var()`      | ç§»åŠ¨çª—å£å†…çš„æ— åä¼°è®¡æ–¹å·®ï¼ˆåˆ†æ¯ä¸º `n-1`ï¼‰                                |
| `skew()`     | ç§»åŠ¨çª—å£å†…çš„ååº¦  (æ ·æœ¬çš„ä¸‰é˜¶æ ‡å‡†åŒ–çŸ©)                                                      |
| `kurt()`     | ç§»åŠ¨çª—å£å†…çš„å³°åº¦   (æ ·æœ¬çš„å››é˜¶æ ‡å‡†åŒ–çŸ©)                                                      |
| `quantile()` | ç§»åŠ¨çª—å£å†…çš„æŒ‡å®šåˆ†ä½æ•°ä½ç½®çš„å€¼ï¼ˆä¼ å…¥çš„åº”è¯¥æ˜¯ `[0,1]` çš„å€¼ï¼‰                 |
| `apply()`    | åœ¨ç§»åŠ¨çª—å£å†…ä½¿ç”¨æ™®é€šçš„ï¼ˆå¯ä»¥è‡ªå®šä¹‰çš„ï¼‰æ•°ç»„å‡½æ•°                           |
| `cov()`      | ç§»åŠ¨çª—å£å†…çš„åæ–¹å·®                                                     |
| `corr()`     | ç§»åŠ¨çª—å£å†…çš„ç›¸å…³ç³»æ•°                                                   |

## æ•°å­¦èšåˆå’Œåˆ†ç»„è¿ç®— â•â–

::: {.callout-note}
ç±»ä¼¼äº SQL æ“ä½œä¸­çš„åˆ†ç»„å’Œèšåˆï¼ŒPandas æä¾›äº† `groupby` åŠŸèƒ½ã€‚
:::

- `groupby` åŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼š
  1. **split**ï¼šæ ¹æ®ä¸€å®šåŸåˆ™å°†æ•°æ®åˆ†ç»„ã€‚
  2. **apply**ï¼šæ¯ä¸ªç»„åˆ†åˆ«æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°å€¼ã€‚
  3. **combine**ï¼šå°†å„ç»„çš„ç»“æœåˆå¹¶åˆ°æœ€ç»ˆå¯¹è±¡ä¸­ã€‚

- **æ‹†åˆ†æ“ä½œ**ï¼š
  - Pandas å¯¹è±¡ï¼ˆ`Series` æˆ– `DataFrame`ï¼‰æ ¹æ®æä¾›çš„é”®åœ¨ç‰¹å®šçš„è½´ä¸Šè¿›è¡Œæ‹†åˆ†ã€‚
  - `DataFrame` å¯ä»¥æŒ‡å®šæ˜¯åœ¨ `index` è½´è¿˜æ˜¯ `columns` è½´ã€‚

## æ‹†åˆ†é”®çš„å½¢å¼

| æ‹†åˆ†é”®çš„å½¢å¼è¯´æ˜                       | ç¤ºä¾‹                                                                  |
| :------------------------------------- | :-------------------------------------------------------------------- |
| å’Œæ‰€é€‰è½´é•¿åº¦ç›¸åŒçš„æ•°ç»„ï¼ˆ`list` æˆ– NumPy çš„ `array`ï¼Œç”šè‡³æ˜¯ä¸€ä¸ª `Series` å¯¹è±¡ï¼‰ | `df.groupby(group_list).count()`                                       |
| `DataFrame` æŸä¸ªåˆ—åçš„å€¼æˆ–åˆ—åçš„ `list`          | `df.groupby('a')`  `df.groupby(df['a'])`                                             |
|                                        | `# ä¸Šè¿°ä¸¤ä¸ªè¡¨è¿°ç­‰ä»·`                                                          |
|                                        |`group_series = pd.Series(group_list)`  `df.groupby(group_series)`    |
| å‚æ•°ä¸º `axis` çš„æ ‡ç­¾çš„å‡½æ•°               | `df.groupby(df.loc['one'],axis=1)`                                   |
|                                        | `def get_index_number(index):`<br> `if index in ['one','two']:` <br>   `return 'small'` <br> `else:` <br>  `return 'big'` <br> `df.groupby(get_index_number)`|
| å­—å…¸æˆ–è€… `Series`ï¼Œç»™å‡º `axis` ä¸Šçš„å€¼ä¸åˆ†ç»„åä¹‹é—´çš„å¯¹åº”å…³ç³»          |`#è¯¥ç¤ºä¾‹ä¸Demo1çš„æ•ˆæœç›¸åŒ`<br>  `group_list = ['one','two','one','two','two']` <br> `group_series = pd.Series(group_list,index = df.index)` <br> `df.groupby(group_series)`                                         |
| ç»„1ã€2ã€3ã€4çš„ `list` æˆ–è€…              | `df.groupby(['a','b'])`                                               |

```{python}
import pandas as pd

data = {'col1': ['A', 'A', 'B', 'B', 'A'],
        'col2': [1, 2, 3, 4, 5],
        'col3': [6, 7, 8, 9, 10]}

df = pd.DataFrame(data)

# æŒ‰ 'col1' åˆ†ç»„ï¼Œè®¡ç®—æ¯ç»„çš„å¹³å‡å€¼
grouped = df.groupby('col1')
print(grouped.mean())

# æŒ‰ 'col1' å’Œ 'col2' åˆ†ç»„ï¼Œè®¡ç®—æ¯ç»„çš„æ€»å’Œ
grouped = df.groupby(['col1', 'col2'])
print(grouped.sum())

# ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°åˆ†ç»„
def custom_group(index):
  if index < 2:
    return 'group1'
  else:
    return 'group2'

grouped = df.groupby(custom_group)
print(grouped.mean())
```

## åº”ç”¨éƒ¨åˆ†

- ä¸»è¦å®ç°ä»¥ä¸‹ä¸‰ç±»æ“ä½œï¼š
  1. **èšåˆæ“ä½œ**ï¼šå¯¹äºæ¯ä¸ªç»„ç»è¿‡è®¡ç®—å¾—åˆ°ä¸€ä¸ªæ¦‚è¦æ€§è´¨çš„ç»Ÿè®¡å€¼ï¼Œä¾‹å¦‚æ±‚å’Œã€æ±‚å¹³å‡ç­‰ã€‚
  2. **è½¬æ¢æ“ä½œ**ï¼šå¯¹äºæ¯ä¸ªç»„ç»è¿‡è®¡ç®—å¾—åˆ°å’Œç»„çš„é•¿åº¦ç›¸åŒçš„ä¸€ç³»åˆ—çš„å€¼ï¼Œä¾‹å¦‚å¯¹æ•°æ®çš„æ ‡å‡†åŒ–ã€å¡«å…… `NA` å€¼ç­‰ã€‚
  3. **è¿‡æ»¤æ“ä½œ**ï¼šé€šè¿‡å¯¹æ¯ä¸ªç»„çš„è®¡ç®—å¾—åˆ°ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å€¼å®Œæˆå¯¹ç»„çš„ç­›é€‰ï¼Œä¾‹å¦‚é€šè¿‡æ±‚å¾—ç»„çš„å¹³å‡å€¼æ¥ç­›é€‰ç»„ï¼Œæˆ–è€…æ¯ä¸ªç»„å†…é€šè¿‡ä¸€å®šçš„æ¡ä»¶è¿›è¡Œç­›é€‰ã€‚

```{python}
import pandas as pd

data = {'group': ['A', 'A', 'B', 'B', 'A'],
        'value': [1, 2, 3, 4, 5]}
df = pd.DataFrame(data)

# èšåˆï¼šè®¡ç®—æ¯ç»„çš„æ€»å’Œ
grouped_sum = df.groupby('group').sum()
print(f"èšåˆ - æ¯ç»„æ€»å’Œ:\n{grouped_sum}")

# è½¬æ¢ï¼šå¯¹æ¯ç»„è¿›è¡Œæ ‡å‡†åŒ–
normalized = df.groupby('group')['value'].transform(lambda x: (x - x.mean()) / x.std())
print(f"è½¬æ¢ - æ ‡å‡†åŒ–:\n{normalized}")

# è¿‡æ»¤ï¼šç­›é€‰å‡º value å¹³å‡å€¼å¤§äº 2 çš„ç»„
filtered = df.groupby('group').filter(lambda x: x['value'].mean() > 2)
print(f"è¿‡æ»¤ - å¹³å‡å€¼å¤§äº 2 çš„ç»„:\n{filtered}")
```

## æ€»ç»“ ğŸ“

- Pandas æ˜¯ Python æ•°æ®åˆ†æçš„é‡è¦å·¥å…·ï¼Œæä¾›äº† `Series` å’Œ `DataFrame` ä¸¤ç§æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚
- Pandas å…·æœ‰å¼ºå¤§çš„æ•°æ®è®¿é—®ã€æ“ä½œã€ç»Ÿè®¡å’Œåˆ†ç»„åŠŸèƒ½ã€‚
- ç†è§£ `loc`ã€`iloc` å’Œ `[]` çš„åŒºåˆ«å¯¹äºé«˜æ•ˆä½¿ç”¨ Pandas è‡³å…³é‡è¦ã€‚
- çª—å£å‡½æ•°æ˜¯å¤„ç†æ—¶åºæ•°æ®çš„æœ‰åŠ›å·¥å…·ã€‚
- `groupby` åŠŸèƒ½å¯ä»¥å®ç°ç±»ä¼¼äº SQL çš„åˆ†ç»„èšåˆæ“ä½œã€‚

## æ€è€ƒä¸è®¨è®º ğŸ¤”

- åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼ˆ`Series` æˆ– `DataFrame`ï¼‰ï¼Ÿ
  - å½“åªéœ€è¦å¤„ç†ä¸€ç»´æ•°æ®ï¼Œæˆ–è€…éœ€è¦ä¸€ä¸ªå¸¦æ ‡ç­¾çš„æ•°ç»„æ—¶ï¼Œé€‰æ‹© `Series`ã€‚
  - å½“éœ€è¦å¤„ç†äºŒç»´æ•°æ®ï¼Œæˆ–è€…éœ€è¦ä¸€ä¸ªè¡¨æ ¼ç»“æ„æ—¶ï¼Œé€‰æ‹© `DataFrame`ã€‚
- `loc` å’Œ `iloc` åœ¨ä½¿ç”¨åœºæ™¯ä¸Šæœ‰å“ªäº›åŒºåˆ«ï¼Ÿ
  - å½“éœ€è¦é€šè¿‡æ ‡ç­¾è®¿é—®æ•°æ®æ—¶ï¼Œä½¿ç”¨ `loc`ã€‚
  - å½“éœ€è¦é€šè¿‡ä½ç½®è®¿é—®æ•°æ®æ—¶ï¼Œä½¿ç”¨ `iloc`